$(function(){$('.widget-code').click(function(e){e.preventDefault();$(this).select();});$('.tabs [data-toggle="tab"]').click(function(e){e.preventDefault();$('.tabs .active, .tab-pane.active').removeClass('active');$(this).parent().addClass('active');$($(this).attr('href')).addClass('active');});var chart;if(typeof graphData!=='undefined'){chart=new Highcharts.Chart({chart:{renderTo:$('.chart-thirtyday')[0],type:'column'},title:{text:'Weather for Past 30 Days'},xAxis:{categories:graphData.dates,labels:{enabled:false}},yAxis:{min:40,tickInterval:10,title:{text:'Algo Temperature'}},legend:{enabled:false},credits:{enabled:false},tooltip:{useHTML:true,formatter:function(){return''+this.x+': '+this.y+'&deg;';}},plotOptions:{column:{pointPadding:0.1,borderWidth:0}},series:[{type:'column',name:'Temperature',data:graphData.temps}]});}
if(typeof metricsData!=='undefined'){Mozcast.Metrics.renderChart($('.active .chart'));$('.tabs [data-toggle="tab"]').click(function(){_gaq.push(['_trackEvent','Metrics','Click',$(this).attr('href')]);Mozcast.Metrics.renderChart($($(this).attr('href')).find('.chart'));});$('.data-limits a').click(function(e){e.preventDefault();$('.data-limits a').removeClass('active');$(this).addClass('active');Mozcast.Metrics.limit=parseInt($(this).data('limit'),10);$('.tabs .active a').click();});}});Mozcast={Metrics:{limit:30,max:90}};Mozcast.Metrics.renderChart=function($chart){var data=eval('metricsData.xAxis.'+$chart.data('chart'));var chart=new Highcharts.Chart({chart:{renderTo:$chart[0],type:'spline'},title:{text:$chart.attr('title')},xAxis:{categories:metricsData.dates.slice(-Mozcast.Metrics.limit),tickInterval:Mozcast.Metrics.limit-1,tickLength:0},yAxis:{title:{text:''}},legend:{enabled:false},credits:{enabled:false},tooltip:{useHTML:true,formatter:function(){var percent=($chart.data('chart')!=='serps')?'%':'';return''+this.x+': '+this.y+percent;}},series:[{type:'spline',data:data.slice(-Mozcast.Metrics.limit),marker:{symbol:'circle',fillColor:'#FFFFFF',lineWidth:2,lineColor:null}}]});};Highcharts.theme={colors:["#55b3d9"],title:{style:{color:'#666',font:'bold 18px Arial, Helvetica, sans-serif'}},yAxis:{labels:{style:{color:'#999',font:'bold 12px Arial, Helvetica, sand-serif'}},title:{style:{color:'#666',font:'bold 14px Arial, Helvetica, sans-serif'}}},labels:{style:{color:'#CCC'}},tooltip:{backgroundColor:{linearGradient:[0,0,0,50],stops:[[0,'rgba(63, 153, 189, .8)'],[1,'rgba(42, 103, 128, .8)']]},borderWidth:0,style:{color:'#FFF',fontWeight:'bold'}},plotOptions:{column:{animation:false},spline:{animation:false}}};var highchartsOptions=Highcharts.setOptions(Highcharts.theme);if(typeof MozcastFeatures!='undefined'){var $feature_change_container=$('#feature-change');var $feature_serps=$('#feature-serps');var changeBarTemplate=Mustache.compile($('#change-bar-template').text());var queryTemplate=Mustache.compile($('#example-query-template').text());$feature_change=$('<ol />');$.each(MozcastFeatures.features,function(i,feature){if(feature.Feature.average)return;$feature_change.append(changeBarTemplate(feature));});$feature_change_container.html($feature_change);renderAverageFeatureChart();$(document).on('click','.feature-checkbox',function(e){if($(this).attr('checked')){_gaq.push(['_trackEvent','Feature','Click',$(this).data('feature')]);$(this).data('src-off',$(this).attr('src'));}
var checkedFeatures=[];var features=[];var $checkedFeatures=$('.feature-checkbox:checked');$feature_serps.html('');if(!$checkedFeatures.length){return renderAverageFeatureChart();}
$checkedFeatures.each(function(){var name=$(this).data('feature');checkedFeatures.push({name:name,data:MozcastFeatures.thirty_day.features[name].Stat});features.push(name);}).promise().done(function(){renderFeatureChart(checkedFeatures);$.get('/features/keywords',{'features[]':features},function(data){if(data.length){$feature_serps.html(queryTemplate({features:data}));}});});});}
function renderAverageFeatureChart(){var averageFeatures=[];for(var name in MozcastFeatures.thirty_day.averages){averageFeatures.push({name:name,data:MozcastFeatures.thirty_day.averages[name].Stat});}
renderFeatureChart(averageFeatures);}
function renderFeatureChart(features){var series=[];$.each(features,function(i,feature){var key=feature.name;series.push({type:'line',name:MozcastFeatures.features[key].Feature.title,color:MozcastFeatures.features[key].FeatureCategory.color2,data:feature.data,marker:{symbol:'circle',fillColor:'#FFFFFF',lineWidth:2,lineColor:null}});});var chart=new Highcharts.Chart({chart:{renderTo:'thirty-day-features',type:'line'},title:{text:'SERP Feature History (Past 30 Days)',},xAxis:{categories:MozcastFeatures.thirty_day.dates,labels:{enabled:true,},tickInterval:3,tickmarkPlacement:'on'},yAxis:{title:{text:'% of Queries'}},legend:{enabled:true,borderWidth:0},tooltip:{useHTML:true,formatter:function(){return''+this.x+': '+this.y+'%';}},plotOptions:{line:{animation:false}},series:series,credits:{enabled:false}});}