/*
 * The information and software code below,
 * located at http://www.invoca.net/0/pnapi_integration.js,
 * are confidential and are the sole property of Invoca.
 * Your application or use of this information in any way is subject to
 * Invoca's Terms of Service, which are located at
 * http://www.invoca.com/terms-of-service. In accordance with those terms, your
 * use of this information and code may be terminated by Invoca at any time
 * for any reason.  The rights granted to you under those terms are expressly
 * non-exclusive. You may not sell, assign, sublicense, or otherwise transfer or
 * agree to transfer all or any portion of those rights without Invoca's
 * prior written consent.  You agree not to copy, republish, frame, download,
 * transmit, modify, rent, lease, loan, sell, assign, distribute, license,
 * sublicense, reverse engineer, or create derivative works based on the
 * information and/or software code on this page except as expressly authorized
 * in Invoca's Terms of Service.  Your use and continued use of this
 * information and/or code constitute your acceptance of Invoca's Terms of Service.
 *
 * Copyright (c) 2014 Invoca (r)
 */

if("undefined"==typeof Invoca)var Invoca={};"undefined"==typeof Invoca.log&&(Invoca.log=function(n,o){"undefined"!=typeof console&&(o&&"undefined"!=typeof console.error?console.error(n):this.debugMode&&"undefined"!=typeof console.log&&console.log(n))}),"undefined"==typeof Invoca.now&&(Invoca.now=function(){return(new Date).getTime()}),Invoca.getCurrentLocation=function(){return window.location.toString()},Invoca.countHash=function(n){var o=0;for(var e in n)n.hasOwnProperty(e)&&(o+=1);return o};

Invoca.PNAPI = { loaded : false };
Invoca.PNAPI.config = { URL : '//pnapi.invoca.net/0/api/VERSION_KEY/map_number.jsonp' };

!function(Invoca){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,o,a,i,c=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,n=0;a>n;n+=1)i[n]=str(n,u)||"null";return o=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+c+"]":"["+i.join(",")+"]",gap=c,o}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;a>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],o=str(r,u),o&&i.push(quote(r)+(gap?": ":":")+o));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(o=str(r,u),o&&i.push(quote(r)+(gap?": ":":")+o));return o=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+c+"}":"{"+i.join(",")+"}",gap=c,o}}Invoca.JSON=window.JSON||{},"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof Invoca.JSON.stringify&&(Invoca.JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof Invoca.JSON.parse&&(Invoca.JSON.parse=function(text,reviver){function walk(e,t){var n,r,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),void 0!==r?o[n]=r:delete o[n]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(Invoca),/*
* Original version:
* Lightweight JSONP fetcher
* Copyright 2010 Erik Karlsson. All rights reserved.
* BSD licensed
*/
function(e){var t,n,r=this;e.JSONP=e.JSONP||{},e.JSONP.counter=0,e.JSONP.load=function(e){var n=document.createElement("script"),r=!1;n.src=e,n.async=!0,n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(r=!0,n.onload=n.onreadystatechange=null,n&&n.parentNode&&n.parentNode.removeChild(n))},t||(t=document.getElementsByTagName("head")[0]),t.appendChild(n)},e.JSONP.requestWithLandingPage=function(t,o,a,i,c,u){var s=!1;return c&&-1!=c.search(/%ESCAPED_URL%/)&&(s=!0),{"get":function(){var t="json_rr"+ ++e.JSONP.counter;return r[t]=function(e){u(e);try{delete r[t]}catch(n){}r[t]=null},o.jsoncallback=t,e.JSONP.load(this.encodeUrl(),u),t},"encodeUrl":function(){var e=-1==t.search(/\?/)?"?":"&";for(n in o)o.hasOwnProperty(n)&&(e+=encodeURIComponent(n)+"="+encodeURIComponent(o[n])+"&");return t=this.encodeVal(t+e,s?1:0),t+=a+this.encodeVal("=",s?1:0)+this.buildLandingPageUrl(),c?s?c.replace(/%ESCAPED_URL%/,t):c.replace(/%UNESCAPED_URL%/,t):t},"buildLandingPageUrl":function(){var e=Invoca.getCurrentLocation(),t="",r="";if(i){t=-1==e.search(/\?/)?"?":"&";for(n in i)if(i.hasOwnProperty(n)){var o,a,c=i[n];"object"==typeof c?(o="undefined"==typeof c.escape||c.escape,a=c.value):(o=!0,a=c.toString()),r+=this.encodeVal(n,s?3:2)+this.encodeVal("=",s?2:1)+(o?this.encodeVal(a,s?3:2):a)+this.encodeVal("&",s?2:1)}r=r.replace(s?/(%2526)$/:/(%26)$/,"")}return this.encodeVal(e+t,s?2:1)+r},"encodeVal":function(e,t){for(var n=e,r=0;t>r;++r)n=encodeURIComponent(n);return n}}}}(Invoca),function(e){function t(e){var t=/[^\d]/g,n=e.replace(t,"");return n}var n="-",r=" ",o="1",a="0";e.NANP_COUNTRY_CODE=o,e.PhoneNumber=function(i,c){var u=t(c?i:""),s=t(c?c:i),f=c?c:i;if(!u)if(11==s.length&&s.charAt(0)==o)u=o,s=s.substr(1);else if(10==s.length&&s.charAt(0)!=a)u=o;else if("+"==i.charAt(0)||"0"==i.charAt(0)){var l=/[\+|0]([\d]{1,2})[^\d]/g,p=i.match(l);if(p){var g=p[0].replace(/^\s+|\s+$/g,"");u=g.substr(1),s=s.substr(u.length)}else e.log("When prefixing a number with + or 0, include a non digit character after the country code")}u==o&&10!=s.length&&e.log("Invalid number: "+u+", "+f,!0),this.format=function(e,t,o){var a;if(this.isNANP()){a=o||n;var i=s.slice(0,3),c=s.slice(3,6),f=s.slice(6),l=i+a+c+a+f;return e&&(l="1"+a+l),l}return a=o||r,(t&&u?"+"+u+a:"")+s},this.formatFromOriginal=function(e,t){var a="",i=/[\s-]/g,c="";return this.isNANP()?(a=t||n,c=f.replace(i,a),e&&"+"!=c.charAt(0)&&(c=o+a+c)):(a=t||r,c=f.replace(i,a)),c},this.isNANP=function(){return u==o},this.isEmpty=function(){return!s},this.toParam=function(){return u==o?s:"00"+u+s},this.toString=function(){return this.format(!0)},this.countryCode=u,this.nationalNumber=s;var v="([^0-9]{0,10})",d="([([])?";this.to_replacement_regex=function(){var e="";"0"==s.charAt(0)?e+="([([]?0[^0-9]{0,10})?"+d:e="(1[^0-9]{0,10})?"+d+s.charAt(0)+v;for(var t=1;t<s.length;t++)e+=t==s.length-1?s.charAt(t):s.charAt(t)+v;return new RegExp(e,"gi")},this.formatFromOther=function(e,t){var n=t.to_replacement_regex().exec(e);if(null==n)return e;for(var r="",o="0"==s.charAt(0)?1:0,a=1;a<=n.length+1;a++)"undefined"!=typeof n[a]&&(r+=n[a]),a>1&&(r+=s.charAt(o),o++);return r}}}(Invoca),Invoca.PNAPI.ALLOWED_VERSIONS=["2014-09-01"],Invoca.PNAPI.requestPromoNumbers=function(e){function t(t){Invoca.log("Invoca.PNAPI.requestPromoNumbers onResponse triggered. Response data below:"),Invoca.log(t),e.context?e.onComplete.apply(e.context,[n,t]):e.onComplete(n,t)}if(!Invoca.PNAPI.settings)return Invoca.log("ERROR: Invoca.PNAPI.settings must be set before calling Invoca.PNAPI.requestPromoNumbers",!0),void 0;if(Invoca.PNAPI.setConfig(Invoca.PNAPI.settings),!e.onComplete)return Invoca.log("Invoca.PNAPI.requestPromoNumbers: onComplete callback is required",!0),void 0;if(!e.requestData||0==e.requestData.length)return Invoca.log("Invoca.PNAPI.requestPromoNumbers: requestData is required and must not be empty",!0),void 0;if(!Invoca.PNAPI.config.networkId)return Invoca.log("ERROR: networkId must be set before calling Invoca.PNAPI.requestPromoNumbers",!0),void 0;var n=e.batchId||(new Date).getTime(),r={"network_id":Invoca.PNAPI.config.networkId,"request_data_shared_params":Invoca.JSON.stringify(e.requestDataSharedParams||{}),"request_data":Invoca.JSON.stringify(e.requestData)},o=(window.location.protocol+Invoca.PNAPI.config.URL).replace(/VERSION_KEY/,Invoca.PNAPI.config.version),a=new Invoca.JSONP.requestWithLandingPage(o,r,"url",{},"",t);a.get()},Invoca.PNAPI.swapNumber=function(e,t){var n=new Invoca.PhoneNumber(t.countryCode||t,t.nationalNumber),r=new Invoca.PhoneNumber(e);return n.formatFromOther(e,r)},Invoca.PNAPI.transformRequestNumberResponseToHash=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].requestId]=e[n];return t},Invoca.PNAPI.getQueryStringHash=function(e){for(var t={},n=e.substr(1).split("&"),r=0;r<n.length;++r){var o=n[r].split("=");t[o[0].toLowerCase()]=o[1]}return t},Invoca.PNAPI.getReferrer=function(){return document.referrer},Invoca.PNAPI.setConfig=function(e){function t(e,t){return"undefined"==typeof e?t:e}if(!Invoca.PNAPI.config.version){var n=Invoca.PNAPI.getQueryStringHash(window.location.search);Invoca.PNAPI.config.networkId=e.networkId,Invoca.PNAPI.config.version=t(e.version,Invoca.PNAPI.ALLOWED_VERSIONS[0]),Invoca.debugMode=t(e.debug,"1"==n.rr_debug)}};
