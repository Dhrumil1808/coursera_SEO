"use strict";var clientFactory=function(fp,http,win,store,uuidGen,session,doc){var endpoint="//ca.simplymeasured.com/track";var hashIdLength=29;var dependencyCollector={fingerPrintProvider:fp,httpMessageProvider:http,windowProvider:win,storageProvider:store,uuidProvider:uuidGen,sessionStorageProvider:session,documentProvider:doc};var fingerPrint=null;var userId;var hashId;function prepMessage(objMessage){if(!fingerPrint||!userId||!hashId){return null}objMessage.fingerPrint=fingerPrint;objMessage.userId=userId;objMessage.hashId=hashId;objMessage.session=getSessionId();objMessage.sessionDomain=getSessionDomain();objMessage.sessionStart=isSessionStart();return objMessage}function messageHost(objMessage){if(dependencyCollector.windowProvider.parent){dependencyCollector.windowProvider.parent.postMessage(JSON.stringify(objMessage),"*")}else{console.log("Client frame not hosted; unable to communicate with host")}}function getUserId(){var cookieId=getCookie("smUserId");var storageId=dependencyCollector.storageProvider.getItem("smUserId");if(!storageId&&cookieId){userId=cookieId;saveStorageUserId(userId);return userId}if(storageId&&!cookieId){userId=storageId;saveCookieUserId(userId);return userId}if(storageId&&cookieId){userId=cookieId;saveStorageUserId(userId);return userId}if(!storageId&&!cookieId){userId=dependencyCollector.uuidProvider.v4();saveStorageUserId(userId);saveCookieUserId(userId);return userId}return userId}function getCookie(name){var value="; "+dependencyCollector.documentProvider.cookie;var parts=value.split("; "+name+"=");if(parts.length==2){return parts.pop().split(";").shift()}}function saveStorageUserId(userId){dependencyCollector.storageProvider.setItem("smUserId",userId)}function saveCookieUserId(userId){dependencyCollector.documentProvider.cookie="smUserId = "+userId+"; expires=Fri, 31 Dec 9999 23:59:59 GMT"}function getUserIdHash(){var parts=userId.split("-");var returnMe="";for(var i=0;i<parts.length;i++){returnMe+=parseInt(parts[i],16).toString(36)}var zerosToAdd=hashIdLength-returnMe.length;var zeros=[];for(var i=0;i<zerosToAdd;i++){zeros.push("0")}returnMe=zeros.join("")+returnMe;hashId=returnMe;return returnMe}function generateSessionId(){return dependencyCollector.uuidProvider.v4().replace(/-/g,"")}function getSessionId(){var now=(new Date).getTime();var then=dependencyCollector.sessionStorageProvider.getItem("smSessionTime");var cookieId=getCookie("smSessionId");var cookieTime=getCookie("smSessionTime");var sessionId=dependencyCollector.sessionStorageProvider.getItem("smSessionId");if(!cookieId){cookieId=sessionId;cookieTime=then;dependencyCollector.documentProvider.cookie="smSessionId = "+cookieId}if(!cookieId||now-cookieTime>18e5){cookieId=generateSessionId();dependencyCollector.sessionStorageProvider.setItem("smSessionId",cookieId);dependencyCollector.sessionStorageProvider.setItem("smSessionDomain","");dependencyCollector.sessionStorageProvider.setItem("smSessionStart",true);dependencyCollector.documentProvider.cookie="smSessionId = "+cookieId;dependencyCollector.documentProvider.cookie="smSessionDomain ="}dependencyCollector.sessionStorageProvider.setItem("smSessionTime",now);dependencyCollector.documentProvider.cookie="smSessionTime = "+now;return cookieId}function isSessionStart(){var sessionStart=dependencyCollector.sessionStorageProvider.getItem("smSessionStart");dependencyCollector.sessionStorageProvider.setItem("smSessionStart",false);if(sessionStart=="true"){return true}return false}function getSessionDomain(){var sessionDomainId=dependencyCollector.sessionStorageProvider.getItem("smSessionDomainId");var domainKey=dependencyCollector.sessionStorageProvider.getItem("smSessionDomain");var cookieId=getCookie("smSessionDomainId");var cookieDomainKey=getCookie("smSessionDomain");var hostKey=dependencyCollector.documentProvider.referrer;var urlParser=dependencyCollector.documentProvider.createElement("a");urlParser.href=hostKey;hostKey=urlParser.hostname;if(!cookieId){cookieId=sessionDomainId;dependencyCollector.documentProvider.cookie="smSessionDomainId = "+cookieId}if(!cookieDomainKey){cookieDomainKey=domainKey;dependencyCollector.documentProvider.cookie="smSessionDomain = "+cookieDomainKey}if(!cookieId||cookieDomainKey!=hostKey){cookieId=generateSessionId();dependencyCollector.sessionStorageProvider.setItem("smSessionDomainId",cookieId);dependencyCollector.sessionStorageProvider.setItem("smSessionDomain",hostKey);dependencyCollector.documentProvider.cookie="smSessionDomainId = "+cookieId;dependencyCollector.documentProvider.cookie="smSessionDomain = "+hostKey}if(cookieId!=sessionDomainId){dependencyCollector.sessionStorageProvider.setItem("smSessionDomainId",cookieId);dependencyCollector.sessionStorageProvider.setItem("smSessionDomain",hostKey)}return cookieId}return{sendMessage:function(objMessage){var timeoutDuration=1e3;var messageStatus=404;function makeHttpCall(){if(messageStatus>=200&&messageStatus<300){return}if(typeof objMessage==="object"){var preppedMessage=prepMessage(objMessage);if(preppedMessage!=null){dependencyCollector.httpMessageProvider.post(endpoint).send(preppedMessage).end(function(err,response){if(response){messageStatus=response.status}})}}timeoutDuration*=2;dependencyCollector.windowProvider.setTimeout(makeHttpCall,timeoutDuration)}makeHttpCall()},initClient:function(){dependencyCollector.fingerPrintProvider.get(function(result){fingerPrint=result});getUserId();getUserIdHash();messageHost({name:"smFrameLoaded",data:{hashId:hashId}})}}};if(typeof exports!=="undefined"){exports.clientFactory=clientFactory}