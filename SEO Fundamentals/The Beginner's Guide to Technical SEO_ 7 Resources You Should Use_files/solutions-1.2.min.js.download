/* ----------------- *
 * SolutionsJS       *
 * Version: 1.2      *
 * Updated: 12/01/15 *
 * ----------------- */

if("undefined"==typeof Invoca)var Invoca={};var Solutions={};Solutions.PNAPI={},Solutions.Tools={},Solutions.PNAPI.settings={useCookie:!0,cookieDays:1,cookieName:"invoca_session",fadeNumber:!1,telLinkOnly:!1,updateTel:!0,numberFormat:0,numberPrefix:"",destinationAsId:!1,campaignIdOverrideParam:null,defaultCampaignId:null,saveCampaignIdOverride:!0,onCompleteOverride:null,requiredParams:{},poolParams:null,savePoolParams:!1,debugMode:!1,params:[]},Solutions.PNAPI.data=[],Solutions.PNAPI.display=function(){Solutions.log("\n"),Solutions.log("SolutionsJS 1.2 C - Logs:"),Solutions.log("-------------------------"),Solutions.forEach(Solutions.PNAPI.data,function(a,b){Solutions.log(a)}),Solutoins.log("\n\n")},Solutions.log=function(a){"undefined"!=typeof console&&"undefined"!=typeof console.log&&Solutions.PNAPI.settings.debugMode&&console.log(a),Solutions.PNAPI.data.push(a)},Solutions.warn=function(a){"undefined"!=typeof console&&"undefined"!=typeof console.warn&&console.warn(a)},Solutions.PNAPI.formatNumber=function(a){a=a.trim().replace(/[^\d]/g,"");var b,c=[a.substring(0,3),a.substring(3,6),a.substring(6,10)];switch(Solutions.PNAPI.settings.numberFormat){case 1:b="("+c[0]+") "+c[1]+" - "+c[2];break;case 2:b=c[0]+"."+c[1]+"."+c[2];break;default:b=c[0]+"-"+c[1]+"-"+c[2]}return b},Solutions.checkDependencies=function(){return!0},Solutions.find=function(a){var b=[],c=function(a){var b=[],c=document.getElementsByTagName("*");return Solutions.forEach(c,function(d,e){var f=d.className.split(" ");Solutions.forEach(f,function(d,f){d==a&&b.push(c[e])})}),b};return 0===a.indexOf(".")?b=document.getElementsByClassName?document.getElementsByClassName(a.slice(1)):c(a.slice(1)):0===a.indexOf("#")?b.push(document.getElementById(a.slice(1))):Solutions.PNAPI.contains(a,".")||Solutions.PNAPI.contains(a,"#")?0===b.length&&"undefined"!=typeof document.querySelectorAll&&(b=document.querySelectorAll(a)):b=document.getElementsByTagName(a),0===b.length&&Solutions.warn('SolutionsJS Warning: Element "'+a+'" was not found or is not supported.'),b},Solutions.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},Solutions.forEach=function(a,b){for(var c=0;c<a.length;c++)b(a[c],c)},Solutions.dataset=function(a,b){return"object"==typeof a?a.getAttribute(b)||null:null},Solutions.getKeys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Solutions.getKeys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}(),Solutions.PNAPI.integration=function(a){return Solutions.checkDependencies()?(Solutions.PNAPI.settings=Solutions.extend(Solutions.PNAPI.settings,a),void Solutions.PNAPI.checkRequiredParams()):(Solutions.warn("SolutionsJS exiting now."),!1)},Solutions.PNAPI.checkRequiredParams=function(){Solutions.log("Checking Required Params...");var a=!1,b="undefined"!=typeof Solutions.PNAPI.settings.requiredParams?Solutions.getKeys(Solutions.PNAPI.settings.requiredParams).length:0,c=(Solutions.PNAPI.getQueryStringsHash(),Solutions.PNAPI.readUrl("PPCPN")||Solutions.PNAPI.readUrl("ppcpn")),d=0;if(c=c?c.replace(/[^\d]/g,""):null,Solutions.log(b),c&&c.length<=11)Solutions.PNAPI.ppcpn(c);else if(b>0){for(var e in Solutions.PNAPI.settings.requiredParams){var f=Solutions.PNAPI.settings.requiredParams[e];(Solutions.PNAPI.readUrl(e)==f||"*"==f)&&d++,Solutions.log(Solutions.PNAPI.readUrl(e)+" : "+f)}a=d==b}else a=!0;Solutions.log("Checking required params... \n Ready? "+a),a&&Solutions.PNAPI.doInvoca()},Solutions.PNAPI.checkOverrideParams=function(){var a=Solutions.PNAPI.settings.campaignIdOverrideParam,b=Solutions.PNAPI.readUrl(Solutions.PNAPI.settings.campaignIdOverrideParam);return a?b?(Solutions.PNAPI.setCookie("invoca_id",b,Solutions.PNAPI.settings.cookieDays),Solutions.PNAPI.setCookie(Solutions.PNAPI.settings.cookieName,"",-1),b):Solutions.PNAPI.readCookie("invoca_id"):!1},Solutions.PNAPI.doInvoca=function(){Invoca.PNAPI.settings={networkId:Solutions.PNAPI.settings.networkId},Invoca.PNAPI.requestPromoNumbers({requestData:Solutions.PNAPI.getRequestData(),requestDataSharedParams:Solutions.PNAPI.readInvocaSessionData(),onComplete:Solutions.PNAPI.settings.onCompleteOverride||Solutions.PNAPI.onInvocaResponse})},Solutions.PNAPI.onInvocaResponse=function(a,b){Solutions.log("Invoca onComplete callback invoked with batchId: "+a);var c=Invoca.PNAPI.transformRequestNumberResponseToHash(b),d=Solutions.find(Solutions.PNAPI.settings.numberSelector);Solutions.forEach(d,function(a,b){try{var d=Solutions.PNAPI._thisCampaignId(a),e=c[d];if(e&&"success"==e.status){var f=e.formattedNumber;Solutions.PNAPI.replaceNumbers(a,f)}}catch(g){Solutions.log("Error: "+g.toString())}})},Solutions.PNAPI.readInvocaData=function(a,b){b=b||null;var c="invoca_session",d=Solutions.PNAPI.readCookie(c);if(d){var e=Invoca.JSON.parse(decodeURIComponent(d));return e[a]||b}return b},Solutions.PNAPI.parseReferrer=function(a,b){if("undefined"==typeof b&&(Solutions.warn("No defaultId passed to Solutions parseReferrer: Returning null if no campaign found."),b=null),0===Solutions.getKeys(a).length)return b;if(""===document.referrer&&a[""])return a[""];var c,d=Solutions.getKeys(a);currentDomain=Solutions.PNAPI.trueDomain(document.referrer);for(var e in d)if(c=d[e],Solutions.PNAPI.contains(currentDomain,c))return a[c];return b},Solutions.PNAPI.contains=function(a,b){return a.indexOf(b)>-1},Solutions.PNAPI.readUrl=function(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},Solutions.PNAPI.trueDomain=function(a){"undefined"==typeof a&&(a=document.domain),Solutions.PNAPI.contains(a,"://")&&(a=a.split("://")[1]),Solutions.PNAPI.contains(a,"/")&&(a=a.split("/")[0]);var b=a.split("www."),c=b[1]||b[0],d=c.split("."),e=2==d[d.length-1].length&&2==d[d.length-2].length,f=!1,g=null;return!e&&d.length>=2?(f=!0,g="."+d[d.length-2]+"."+d[d.length-1]):e&&d.length>=4&&(f=!0,g="."+d[d.length-3]+"."+d[d.length-2]+"."+d[d.length-1]),g},Solutions.PNAPI.readCookie=function(a){for(var b,c,d=document.cookie.split("; "),e=d.length-1;e>=0;e--)if(b=d[e],c=b.split("="),c[0]==a)return c[1];return null},Solutions.PNAPI.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString(),f="path=/",g="domain="+Solutions.PNAPI.trueDomain();document.cookie=a+"="+b+"; "+e+"; "+f+"; "+g},Solutions.PNAPI.getQueryStringsHash=function(){for(var a={},b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),c=b.length-1;c>=0;c--){var d=b[c].split("=");a[d[0].toLowerCase()]=d[1]}return a},Solutions.PNAPI.deviceType=function(){return window.screen.width<766&&/Android|webOS|iPhone|BlackBerry|IEMobile/i.test(navigator.userAgent)?"mobile":window.screen.width>766&&/Android|webOS|iPad/i.test(navigator.userAgent)?"tablet":window.screen.width>766?"desktop":"unknown"},Solutions.PNAPI.isMobile=function(){var a=Solutions.PNAPI.deviceType();return"desktop"!=a&&"unknown"!=a},Solutions.PNAPI.waitFor=function(a,b,c,d){function e(){var h=a();return h?void b(h):(f++,f*g>=d?void b(c):void setTimeout(e,g))}d=d||1e3,c=c||null;var f=0,g=10;e()},Solutions.PNAPI.getParams=function(){for(var a,b={},c=Solutions.PNAPI.settings.params.length-1;c>=0;c--)a=Solutions.PNAPI.settings.params[c],b[a]=Solutions.PNAPI.readUrl(a)||Solutions.PNAPI.readCookie(a)||" ";return Solutions.log(b),b=Solutions.extend(b,Solutions.PNAPI.settings.poolParams)},Solutions.PNAPI.readInvocaSessionData=function(){var a=Solutions.PNAPI.readCookie(Solutions.PNAPI.settings.cookieName),b=null;if(a)return b=Invoca.JSON.parse(decodeURIComponent(a)),Solutions.PNAPI.settings.savePoolParams===!1&&(b=Solutions.extend(b,Solutions.PNAPI.settings.poolParams)),b;b=Solutions.PNAPI.getParams();var c=Invoca.JSON.stringify(b);return c=encodeURIComponent(c),Solutions.PNAPI.setCookie(Solutions.PNAPI.settings.cookieName,c,Solutions.PNAPI.settings.cookieDays),b},Solutions.PNAPI.ppcpn=function(a){var b=Solutions.find(Solutions.PNAPI.settings.numberSelector);Solutions.forEach(b,function(b,c){Solutions.PNAPI.replaceNumbers(b,a)})},Solutions.PNAPI.replaceNumbers=function(a,b){var c=b,d=a.innerText||a.textContent,e=a.innerHTML,f=Invoca.PNAPI.swapNumber(d,d),g=Invoca.PNAPI.swapNumber(d,c);Solutions.PNAPI.settings.telLinkOnly?Solutions.log("Number not swapped because button only mode active."):d.match(/\d+/g)&&(a.innerHTML=Solutions.PNAPI.settings.numberPrefix+e.replace(f,g)),Solutions.PNAPI.settings.updateTel&&Solutions.PNAPI.updateTel(a,c)},Solutions.PNAPI.updateTel=function(a,b){a.href?a.href="tel:"+b:"undefined"!=typeof a.parentNode.href?a.parentNode.href="tel:"+b:Solutions.log("No tel: links updated because none were found.")},Solutions.PNAPI.getRequestData=function(){var a=[],b=Solutions.PNAPI.getCampaignIds();for(var c in b)a.push({request_id:c,advertiser_campaign_id_from_network:c});return"null"==a[0].advertiser_campaign_id_from_network&&Solutions.warn("SolutionsJS Error: No campaign ID was passed."),a},Solutions.PNAPI.getCampaignIds=function(){var a={},b=Solutions.PNAPI.checkOverrideParams(),c=Solutions.PNAPI.settings.defaultCampaignId;if(b)a[b]=!0;else{var d=Solutions.find(Solutions.PNAPI.settings.numberSelector);Solutions.forEach(d,function(b,d){Solutions.dataset(b,"data-invoca")&&Solutions.warn('SolutionsJS Warning: "data-invoca" tag will not be supported in 2.0. Please use "data-invoca-campaign-id".'),thisCampaign=Solutions.PNAPI.getDestinationAsId(b)||Solutions.dataset(b,"data-invoca-campaign-id")||Solutions.dataset(b,"data-invoca")||c,a[thisCampaign]=!0})}return a},Solutions.PNAPI.getDestinationAsId=function(a){var b=a.innerText||a.textContent;return b=b.toLowerCase().split("x")[0].replace(/[^\d]/g,""),b="1"==b[0]?b.slice(1):b,Solutions.PNAPI.settings.destinationAsId&&!Solutions.PNAPI.checkOverrideParams()?b:null},Solutions.PNAPI._thisCampaignId=function(a){var b=Solutions.PNAPI.readUrl(Solutions.PNAPI.settings.campaignIdOverrideParam),c=b||Solutions.PNAPI.readCookie("invoca_id"),d=c||Solutions.PNAPI.getDestinationAsId(a),e=d||Solutions.dataset(a,"data-invoca-campaign-id")||Solutions.dataset(a,"data-invoca"),f=e||Solutions.PNAPI.settings.defaultCampaignId;return f};