/* For licensing information see https://assets.contextly.com/kit/4.2.2/licenses.txt */
!function(c,ns){var v=c[ns]=c[ns]||{};v.urls={cdn:"https://assets.contextly.com/kit/",main:{dev:"//dev.contextly.com/",live:"//contextly.com/"},cp:{dev:"https://dev.contextly.com/",live:"https://contextly.com/"},api:{dev:"//devrest.contextly.com/",live:"//rest.contextly.com/"},experience:{dev:"//devexperience.contextly.com/",live:"//experience.contextly.com/"}},v.versions={kit:"4.2.2"}}(Contextly,"data"),function(c,ns){var v=c[ns]=c[ns]||{};v.widgets={dependencies:["jquery","webfontloader","easyxdm","json2"],js:["widgets"],css:["widgets"]},v["overlay-dialogs/overlay"]={dependencies:["jquery"],js:["overlay-dialogs--overlay"],css:["overlay-dialogs--overlay"]},v["overlay-dialogs/link"]={dependencies:["jquery"],js:["overlay-dialogs--link"],css:["overlay-dialogs--link"]},v["overlay-dialogs/sidebar"]={dependencies:["jquery"],js:["overlay-dialogs--sidebar"],css:["overlay-dialogs--sidebar"]},v["overlay-dialogs/snippet"]={dependencies:["jquery"],js:["overlay-dialogs--snippet"],css:["overlay-dialogs--snippet"]},v.jquery={js:["jquery"]},v.webfontloader={js:["webfontloader"]},v.easyxdm={js:["easyxdm"]},v.json2={js:["json2"]}}(Contextly,"assets"),Contextly=window.Contextly||{},Contextly.createClass=function(data){var statics=data.statics||{},extend=data.extend||[];extend instanceof Array||(extend=[extend]);var constructor;constructor=data.construct?data.construct:extend.length?function(){for(var i=0;i<extend.length;i++)extend[i].apply(this,arguments)}:function(){};var proto={};delete data.construct,delete data.statics,delete data.extend;for(var i=0;i<extend.length;i++){var parent=extend[i];for(var p in parent)"function"==typeof parent[p]&&"construct"!=p&&(constructor[p]=parent[p]);for(var p in parent.prototype)"function"==typeof parent.prototype[p]&&"constructor"!=p&&(proto[p]=parent.prototype[p])}proto.instanceOf=function(_class){if(arguments.length>1){for(var res=!0,i=0;i<arguments.length;i++)res=res&&this.instanceOf(arguments[i]);return res}if(constructor===_class)return!0;for(var i=0;i<extend.length;i++)if(extend[i].prototype.instanceOf.call(this,_class))return!0;return _class===Object};for(var p in data)"function"==typeof data[p]&&(proto[p]=data[p]);for(var p in statics)"function"==typeof statics[p]&&(constructor[p]=statics[p]);if("undefined"==typeof constructor.construct&&extend.length){for(var parentStaticConstructors=[],i=0;i<extend.length;i++){var parent=extend[i];"function"==typeof parent.construct&&parentStaticConstructors.push(parent.construct)}parentStaticConstructors.length&&(constructor.construct=function(){for(var i=0;i<parentStaticConstructors.length;i++)parentStaticConstructors[i].call(this)})}return"function"==typeof constructor.construct&&constructor.construct.call(constructor),constructor.prototype=proto,constructor.fn=proto,constructor},Contextly.abstractMethod=function(){return function(){Contextly.Utils.error("Abstract method must not be called directly.")}},Contextly.Destroyable=Contextly.createClass({destroy:function(){this.isDestroyed()||(this.destroyReferences(),this.destroyed=!0)},destroyReferences:function(){for(var properties=this.getDestroyableProperties(),i=0;i<properties.length;i++){var key=properties[i];null!=this[key]&&(Contextly.Utils.isFunction(this[key].destroy)&&this[key].destroy(),delete this[key])}},isDestroyed:function(){return null!=this.destroyed},getDestroyableProperties:function(){return[]}}),Contextly.Proxy=Contextly.createClass({extend:Contextly.Destroyable,proxy:function(func,passContext,passArguments){var proxy,self=this,f=function(){if(!self.isDestroyed())return func.apply(this,arguments)};return proxy=passArguments?passContext?function(){return Array.prototype.unshift.call(arguments,this),f.apply(self,arguments)}:function(){return f.apply(self,arguments)}:passContext?function(){return f.call(self,this)}:function(){return f.call(self)}}}),function(){Contextly.Utils=Contextly.createClass({statics:{escape:function(text){return(text+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},htmlToText:function(html){var map={amp:"&",lt:"<",gt:">",quot:'"',"#039":"'",apos:"'",nbsp:" "};return(html+"").replace(/<[a-z0-9\/][^>]*>/gi,"").replace(/&(#[0-9]+|[a-z]+);/gi,function(match,p1){return null!=map[p1]?map[p1]:match})},escapeSizzleAttrValue:function(value){return value?value.replace(/[^\u0080\u002D\u005F\u0030-\u0039\u0041-\u005A\u0061-\u007A]/g,function(found){var code=found.charCodeAt(0);return 0===code?"\\00FFFD":code>=1&&code<=31?"\\"+code.toString(16)+" ":"\\"+found}):""},logError:function(){window.console&&"function"==typeof console.error&&console.error.apply(console,arguments)},isEmailValid:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)},isArray:function(o){return"[object Array]"===Object.prototype.toString.call(o)},isString:function(o){return"string"==typeof o||o instanceof String},isFunction:function(o){return"function"==typeof o},isObject:function(o){return"object"==typeof o},merge:function(){for(var result={},i=0;i<arguments.length;i++){var obj=arguments[i];for(var k in obj)result[k]=obj[k]}return result},isEmptyObject:function(o){for(var key in o)return!1;return!0},error:function(msg){throw msg},escapeRegexp:function(str){return str?str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):""},parseUrlQueryParameter:function(key,url){var expression="[\\?&]"+Contextly.Utils.escapeRegexp(key)+"=([^&#]*)",regexp=new RegExp(expression),results=regexp.exec(url);return null==results?"":results[1]},addHeadElement:function(element){var ref=document.getElementsByTagName("script")[0];ref.parentNode.insertBefore(element,ref)},parseArgs:function(args,specs){for(var params={},index=0,i=0;i<specs.length;i++){var spec=specs[i],name=spec[0],candidate=args[index];if(null!=candidate&&Contextly.Utils[spec[1]](candidate))params[name]=candidate,index++;else{spec[2]&&Contextly.Utils.error("Required parameter "+name+" not found.");var fallback=spec[3];null!=fallback&&(params[name]=fallback)}}return params},resolveUrlProtocol:function(url,isHttps){return null==isHttps&&(isHttps=Contextly.Settings.isHttps()),"//"===url.substr(0,2)&&(url="http"+(isHttps?"s":"")+":"+url),url},trim:function(text){return(text||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}}})}(),Contextly.CorsRequest=Contextly.createClass({extend:Contextly.Proxy,construct:function(params){this.params=params,this.response=null,this.sameProtocol=!1,this.xdr=null,this._initXdr()},send:function(){var method=this.params.method||"GET",url=this.params.url;this.sameProtocol&&(url=url.replace(/^http[s]?:\/\//,document.location.protocol+"//")),this.xdr.open(method,url),this.xdr.send(),this.id=++Contextly.CorsRequest.lastId,Contextly.CorsRequest.requests[this.id]=this},onSuccess:function(){this.complete=!0,this.params.success(this.xdr.responseText),this.cleanup()},cleanup:function(){null!=this.id&&null!=Contextly.CorsRequest.requests[this.id]&&delete Contextly.CorsRequest.requests[this.id]},isComplete:function(){return this.complete},_initXdr:function(){var xdr;"XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest?(xdr=new XMLHttpRequest,xdr.onreadystatechange=this.proxy(function(){4==xdr.readyState&&200==xdr.status&&this.onSuccess()})):"XDomainRequest"in window?(xdr=new XDomainRequest,xdr.onload=this.proxy(function(){this.onSuccess()}),xdr.onerror=this.proxy(function(){this.cleanup()}),xdr.onprogress=function(){},this.sameProtocol=!0):Contextly.Utils.error("Unable to perform Cross-Domain request."),this.xdr=xdr}}),Contextly.CorsRequest.lastId=0,Contextly.CorsRequest.requests={},Contextly.CallbacksGate=Contextly.createClass({extend:Contextly.Proxy,construct:function(){this.left=0,this.lastId=0,this.sealed=!0,this.finished=!1,this.reasons={},this.results=[]},addReason:function(){var id=++this.lastId,reason=this.proxy(function(){this.onReasonAppeared(id)});return this.reasons[id]=!1,this.left++,reason},onReasonAppeared:function(id){this.reasons[id]||(this.reasons[id]=!0,this.left--,this.check())},onQueueComplete:function(){if(!this.finished){this.finished=!0;for(var i=0;i<this.results.length&&!this.isDestroyed();i++){var result=this.results[i],callback=result[0],args=Array.prototype.slice.call(result,1);callback.apply(this,args)}this.reasons={},this.results=[]}},appendResult:function(callback){this.results.push(arguments)},prependResult:function(callback){this.results.unshift(arguments)},waitFor:function(gate){this!==gate&&gate.appendResult(this.addReason())},check:function(){this.isSealed()||0===this.left&&this.onQueueComplete()},isSealed:function(){return this.sealed},unseal:function(){this.sealed=!1,this.check()},isComplete:function(){return this.finished}}),function(){var ov=Contextly.overrides=Contextly.overrides||{};Contextly.Settings=Contextly.createClass({statics:{getServerUrl:function(type){Contextly.data.urls[type]||Contextly.Utils.error(type+" server URL not found.");var url=null,isHttps=this.isHttps(),urls=Contextly.data.urls[type];if(Contextly.Utils.isString(urls))url=urls;else{var keys={};keys[this.getMode()]=!0,keys[isHttps?"https":"http"]=!0;for(var key in keys)if(null!=urls[key]){if(Contextly.Utils.isString(urls[key])){url=urls[key];break}urls=urls[key]}}return null==url&&Contextly.Utils.error(type+" server URL not found"),Contextly.Utils.resolveUrlProtocol(url,isHttps)},getMainServerUrl:function(){return ov.mainServerUrl||this.getServerUrl("main")},getAPIServerUrl:function(){return ov.apiServerUrl||this.getServerUrl("api")},getExperienceServerUrl:function(){return ov.experienceServerUrl||this.getServerUrl("experience")},isAdmin:function(){return"admin"in ov&&ov.admin},isBrandingDisplayed:function(){return!("branding"in ov)||ov.branding},isHttps:function(){return"https"in ov?ov.https:"https:"===document.location.protocol},getClientInfo:function(){return ov.client||null},getKitVersion:function(){return ov.kit||Contextly.data.versions.kit},getAssetUrl:function(path,ext){var prefix=ov.assetUrl||this.getServerUrl("cdn")+this.getKitVersion();return prefix.replace(/\/$/,"")+"/"+path+"."+ext},getMode:function(){return ov.mode||"live"}}})}(),Contextly.Transmitter=Contextly.createClass({broadcast:function(type){if("undefined"!=typeof window.jQuery){var args=Array.prototype.slice.call(arguments,1);jQuery(window).triggerHandler(type,args)}}}),Contextly.loader=Contextly.loader||{},Contextly.loader.Controller=Contextly.createClass({statics:{ready:function(command){if(!Contextly.Utils.isFunction(command)){var allowed={widgets:!0,load:!0,onload:!0,assets:!0,libraries:!0,expose:!0};command in allowed||Contextly.Utils.error("Unknown loader command "+command),command=this[command]}var args=Array.prototype.slice.call(arguments,1);command.apply(this,args)},load:function(){var args=Contextly.Utils.parseArgs(arguments,[["name","isString",!1,"widgets"],["callback","isFunction",!1]]),name=args.name,gate=new Contextly.CallbacksGate;args.callback&&gate.appendResult(args.callback),Contextly.loader.PackageManager.load(name,gate),gate.unseal()},onload:function(){var args=Contextly.Utils.parseArgs(arguments,[["name","isString",!1,"widgets"],["callback","isFunction",!0]]);Contextly.loader.PackageManager.addCallback(args.name,args.callback)},assets:function(){var args=Contextly.Utils.parseArgs(arguments,[["options","isObject",!0]]);Contextly.loader.PackageManager.setOptions(args.options)},libraries:function(){var args=Contextly.Utils.parseArgs(arguments,[["libs","isObject",!0]]);Contextly.loader.LibrariesManager.setOptions(args.libs)},expose:function(){var args=Contextly.Utils.parseArgs(arguments,[["packages","isObject",!0]]);Contextly.loader.PackageManager.exposePackages(args.packages)},widgets:function(){var args=Contextly.Utils.parseArgs(arguments,[["command","isString",!1,"add"],["package","isString",!1,"widgets"],["options","isObject",!1,{}]]);this.load(args.package,function(){Contextly.widget.Controller.command(args.command,args.options)})},init:function(name){if(name=name||"loader",Contextly.assets[name]=Contextly.assets[name]||{},Contextly.loader.PackageManager.onPackageLoaded(name),Contextly.ready=function(){var c=Contextly.loader.Controller;c.ready.apply(c,arguments)},Contextly.q&&Contextly.Utils.isArray(Contextly.q))for(Contextly.q.length||Contextly.q.push(["load","widgets",function(){}]);Contextly.q.length;)Contextly.ready.apply(Contextly,Contextly.q.shift())}}}),Contextly.loader.CssManager=Contextly.createClass({extend:Contextly.Proxy.fn,statics:{construct:function(){this.pending=[],this.elements={},this.references={}},loadFile:function(key,url,gate){var item={key:key,url:url,reason:gate.addReason(),code:null};this.pending.push(item);var request=new Contextly.CorsRequest({url:url,success:this.proxy(function(text){item.code=text,this.onFileDownloaded(item)},!1,!0)});request.send()},convertUrlsToAbsolute:function(fileUrl,code){var baseUrl=fileUrl.replace(/[^\/]+$/,"");return code.replace(/(url\(\s*['"]?)([^"'\)]+)/gi,function(match,prefix,url){return url.match(/^(\?|#|\/|http[s]?:\/\/)/)?match:prefix+baseUrl+url})},onFileDownloaded:function(affected){for(affected.code=this.convertUrlsToAbsolute(affected.url,affected.code);this.pending[0]&&null!==this.pending[0].code;){var item=this.pending.shift(),style=this.buildStyleElement(item.key,item.code);Contextly.Utils.addHeadElement(style),setTimeout(item.reason,0)}},buildStyleElement:function(key,code){var style=document.createElement("style");return style.type="text/css",style.setAttribute("data-ctx-key",key),style.styleSheet?style.styleSheet.cssText=code:style.appendChild(document.createTextNode(code)),this.elements[key]=style,style},loadCode:function(key,code){if(this.styleExists(key))return void this.references[key]++;if(!Contextly.Utils.isFunction(code)||(code=code(),null!=code&&""!==code)){this.references[key]=this.references[key]||0,this.references[key]++;var style=this.buildStyleElement(key,code);Contextly.Utils.addHeadElement(style)}},styleExists:function(key){return!!this.elements[key]},removeCode:function(key){this.styleExists(key)&&(this.references[key]--,this.references[key]>0||(this.elements[key].parentNode&&this.elements[key].parentNode.removeChild(this.elements[key]),delete this.elements[key],delete this.references[key]))}}}),Contextly.loader.JsCorsLoader=Contextly.createClass({extend:Contextly.Proxy,construct:function(){this.pending=[]},load:function(key,url,gate){var item={key:key,url:url,reason:gate.addReason(),code:null};this.pending.push(item);var request=new Contextly.CorsRequest({url:url,success:this.proxy(function(text){item.code=text,this.onFileDownloaded(item)},!1,!0)});request.send()},onFileDownloaded:function(affected){for(;this.pending[0]&&null!==this.pending[0].code;){var item=this.pending.shift();item.code+="\n//# sourceURL="+item.url,this.execScript(item.code),item.reason()}},execScript:function(data){(window.execScript||function(data){window.eval.call(window,data)})(data)}}),Contextly.loader.JsIeLoader=Contextly.createClass({extend:Contextly.Proxy,construct:function(){this.loading=[],this.loaded=[]},onStateChange:function(){for(var script;this.loading[0]&&"loaded"==this.loading[0].readyState;)script=this.loading.shift(),this.loaded.push(script),Contextly.Utils.addHeadElement(script);for(;this.loaded[0]&&"complete"==this.loaded[0].readyState;)script=this.loaded.shift(),script.onreadystatechange=null,script.ctxReason()},load:function(key,url,gate){var script=document.createElement("script");script.setAttribute("data-ctx-key",key),script.ctxReason=gate.addReason(),this.loading.push(script),script.onreadystatechange=this.proxy(this.onStateChange),script.src=url}}),Contextly.loader.JsManager=Contextly.createClass({statics:{construct:function(){this.loader=this._detectLoader()},_detectLoader:function(){var script=document.createElement("script");return!("async"in script)&&"readyState"in script?new Contextly.loader.JsIeLoader:new Contextly.loader.JsCorsLoader},loadFile:function(key,url,gate){this.loader.load(key,url,gate)}}}),Contextly.assets=Contextly.assets||{},Contextly.loader.PackageManager=Contextly.createClass({extend:[Contextly.Transmitter.fn,Contextly.Proxy.fn],statics:{construct:function(){this.packages={},this.loading={},this.callbacks={},this.options={js:{},css:{}}},getConfig:function(name){if(!Contextly.assets[name])throw"Package assets not found: "+name;return Contextly.assets[name]},setOptions:function(options){this.options=Contextly.Utils.merge(this.options,options)},addCallback:function(name,callback){this.callbacks[name]=this.callbacks[name]||[],this.callbacks[name].push(callback)},load:function(name,gate){return gate=gate||new Contextly.loader.CallbacksGate,this.loadPackage(name,gate),gate},loadPackage:function(name,gate){if(!this.isPackageExcluded(name)){if(name in this.packages)return void(this.packages[name]===Contextly.loader.packageStates.LOADING&&gate.waitFor(this.loading[name]));var config=this.getConfig(name);if(this.loading[name]=gate,this.packages[name]=Contextly.loader.packageStates.LOADING,this.broadcast(Contextly.loader.broadcastTypes.LOADING,name,config,gate),name in this.callbacks)for(var i=this.callbacks[name].length-1;i>=0;i--)gate.prependResult(this.callbacks[name][i]);gate.prependResult(this.proxy(this.onPackageLoaded,!1,!0),name),this.loadDependencies(config,gate),this.loadAssets(config,gate),this.loadTemplates(config,gate)}},loadDependencies:function(config,gate){if(config.dependencies&&config.dependencies.length)for(var i=0;i<config.dependencies.length;i++)this.loadPackage(config.dependencies[i],gate)},loadAssets:function(config,gate){var i,path,url,manager,types={js:Contextly.loader.JsManager,css:Contextly.loader.CssManager};for(var type in types)if(type in config&&!this.isExcluded(this.options[type],"*"))for(manager=types[type],i=0;i<config[type].length;i++)path=config[type][i],this.isExcluded(this.options[type],path)||(url=config.foreign?path:Contextly.Settings.getAssetUrl(path,type),manager.loadFile(path,url,gate))},loadTemplates:function(config,gate){config.tpl&&Contextly.loader.TemplatesManager.load(config,gate)},isPackageExcluded:function(name){var libs=Contextly.loader.LibrariesManager.getFlags();return this.isExcluded(libs,"*")||this.isExcluded(libs,name)},isExcluded:function(list,name){return name in list&&!list[name]},onPackageLoaded:function(name){name in this.loading&&delete this.loading[name];var config=this.getConfig(name);"expose"in config&&(this.exposePackages(config.expose),delete config.expose),this.packages[name]=Contextly.loader.packageStates.LOADED,this.broadcast(Contextly.loader.broadcastTypes.LOADED,name)},exposePackages:function(packages){Contextly.assets=Contextly.Utils.merge(Contextly.assets,packages)}}}),Contextly.loader.packageStates={LOADING:"loading",LOADED:"loaded"},Contextly.loader.broadcastTypes={LOADING:"contextlyAssetsLoading",LOADED:"contextlyAssetsLoaded"},Contextly.loader.LibrariesManager=Contextly.createClass({statics:{construct:function(){this.detected=!1,this.libraries=null,this.detectors=null},setOptions:function(flags){this.detected=!1,this.libraries=Contextly.Utils.merge(this.getDefaults(),this.libraries,flags)},getFlags:function(){return null==this.libraries&&(this.libraries=this.getDefaults()),this.detected||(this.libraries=this.detect(this.libraries),this.detected=!0),this.libraries},getDefaults:function(){return{jquery:"auto",easyxdm:"auto",json2:"auto",webfontloader:"auto"}},detect:function(libs){null==this.detectors&&(this.detectors=this.getDetectors());var results={};for(var name in libs)"auto"===libs[name]&&name in this.detectors?results[name]=this.detectors[name]():results[name]=libs[name];return results},getDetectors:function(){return{jquery:function(){return!window.jQuery},easyxdm:function(){return!window.easyXDM},json2:function(){return!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)},webfontloader:function(){return!window.WebFont}}}}}),Contextly.loader.Controller.init();
//# sourceMappingURL=loader.js.map