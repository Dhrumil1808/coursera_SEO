pty.themes = [];
						pty.popupid = 14;
						pty.autoid = 14;
						pty.theme = pty.themes[14] = {"name":"Dimensional","file":"dimensional","author":"Nicky Hajal","descr":"Bright, smooth, eye-grabbing.","copy":{"heading":{"label":"Heading","text":"Join Over 180,000 of Your Peers!","type":"input","edited":"true"},"mainText":{"label":"Main Text","text":"Get daily articles and news delivered to your email inbox and get CMI's exclusive eBook FREE.","type":"html","edited":"true"},"sideHeading":{"label":"Side Heading","text":"Sign Up Now","type":"input","edited":"true"},"sideText":{"label":"Side Text","text":"Get <em>Get Inspired: 75 (More) Content Marketing Examples<\/em> free!","type":"html","edited":"true"},"mainImage":{"label":"Product Image","src":"http:\/\/contentmarketinginstitute.com\/wp-content\/uploads\/2016\/11\/2016-Examples-ebook-cover_pippity.png","size":"165x180","type":"image"},"name":{"text":"first name","label":"Name Input Label","type":"field"},"email":{"label":"E-Mail Input Label","text":"email","type":"field"},"submit":{"text":"Sign Up Now","type":"submit","label":"Submit Button Label"}},"x":"center","y":"center","styleImgs":{"background":"orange","bullet":"orange","submit":"blue"},"fonts":["aurulent_sans","pt_sans"],"css":".pty_pkg div, \n.pty_pkg span, \n.pty_pkg applet, \n.pty_pkg object, \n.pty_pkg iframe, \n.pty_pkg h1, \n.pty_pkg h2, \n.pty_pkg h3, \n.pty_pkg h4, \n.pty_pkg h5, \n.pty_pkg h6, \n.pty_pkg p, \n.pty_pkg blockquote, \n.pty_pkg pre, \n.pty_pkg a, \n.pty_pkg abbr, \n.pty_pkg acronym, \n.pty_pkg address, \n.pty_pkg big, \n.pty_pkg cite, \n.pty_pkg code, \n.pty_pkg del, \n.pty_pkg dfn, \n.pty_pkg em, \n.pty_pkg font, \n.pty_pkg img, \n.pty_pkg ins, \n.pty_pkg kbd, \n.pty_pkg q, \n.pty_pkg s, \n.pty_pkg samp, \n.pty_pkg small, \n.pty_pkg strike, \n.pty_pkg strong, \n.pty_pkg sub, \n.pty_pkg sup, \n.pty_pkg tt, \n.pty_pkg var, \n.pty_pkg b, \n.pty_pkg u, \n.pty_pkg i, \n.pty_pkg center, \n.pty_pkg dl, \n.pty_pkg dt, \n.pty_pkg dd, \n.pty_pkg ol, \n.pty_pkg ul, \n.pty_pkg li, \n.pty_pkg fieldset, \n.pty_pkg form, \n.pty_pkg label, \n.pty_pkg legend, \n.pty_pkg table, \n.pty_pkg caption, \n.pty_pkg tbody, \n.pty_pkg tfoot, \n.pty_pkg thead, \n.pty_pkg input, \n.pty_pkg tr, \n.pty_pkg th,                              \n.pty_pkg td{\n\tbackground-color:transparent;\n\tbackground-image:none;\n\tborder:0 none;\n\tclear:none;\n\tfont-size:18px;\n\tletter-spacing:0;\n\tline-height:100%;\n\tlist-style:none outside none !important;\n\tmargin:0;\n\toutline:0 none;\n\tpadding:0;\n\ttext-align:left;\n\ttext-decoration:none;\n\ttext-indent:0;\n\t-moz-box-shadow:0 0 0;\n\tbox-shadow:0 0 0;\n\t-webkit-box-shadow:0 0 0;\n\tbox-sizing: content-box;\n\t-webkit-box-sizing: content-box;\n\t-moz-box-sizing: content-box;\n}\n#pty_overlay{ \n\tposition:fixed; \n\tz-index:100000; \n\theight:100%; \n\twidth:100%; \n\ttop:0; \n\tleft:0;\n}\n#pty_popup{ \n\tposition:fixed; \n\tz-index:100001; \n}\n#pty_submit{\n\tcursor:pointer\n}\n.pty_pkg input{\n\tpadding:0; margin:0;\n}\n.pty_input {\n   -moz-box-sizing:    content-box;\n   -webkit-box-sizing: content-box;\n    box-sizing:        content-box;\n} \n#pty_preload{\n\tdisplay:none;\n}\n.pty_fontload{\n\twidth:1px;\n\theight:1px;\n\toverflow:hidden;\n\tposition:absolute;\n\ttop:-9999px;\n\tleft:-9999px;\n}\n#pty_afflink{\n\tdisplay:none;\n}\n #pty_afflinkShell { \ttext-align: center; }  #pty_afflink { \ttext-align: center; \tposition: relative; \ttext-decoration: none; \tborder-radius: 4px 4px 4px 4px; \ttext-shadow: 1px 1px 0 #4B3501; \tfont-style: italic; \tfont-family: \"Georgia\"; \tfont-size: 13px; \tpadding: 6px 14px 6px 26px; \tdisplay: inline !important; \tbackground: url(\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/images\/icon.png) no-repeat scroll 5px 5px rgba(21, 16, 9, 0.6); \tcolor: #EFEFEF; \ttop: 21px; }  #pty_smoothInner { \twidth: 856px; \tposition: relative; }  #pty_smooth { \toverflow: hidden; \tbackground-repeat: no-repeat; \theight: 441px; \tpadding: 45px 28px; \twidth: 886px; }  #pty_overlay { \tbackground: none repeat scroll 0 0 #EDEDED;filter:alpha(opacity=95); \topacity: 0.95; }  #pty_mainImageShell { \tfloat: right; \tmargin-right: 23px; \tmargin-top: 15px; \tfont-family: \"PTSansBoldItalic\"; }  #pty_content { \tposition: relative; \tpadding: 26px 0 10px 38px; \ttop: 2px; \tfont-family: \"PTSansBoldItalic\"; \theight: 310px; }  #pty_heading { \tline-height: 100%; \tcolor: #555555; \ttext-shadow: 1px 1px 1px #FFFFFF; \tfont-size: 35px; \tmargin-bottom: 0; \twidth: 479px; \tfont-family: \"PTSansBoldItalic\"; }  #pty_mainText { \tposition: relative; \tz-index: 2; \tpadding: 14px 0 26px; \tfont-size: 20px; \tline-height: 160%; \twidth: 465px; \tcolor: #939393; \ttext-shadow: 1px 1px 0 #FFFFFF; \tfont-family: \"PTSansBoldItalic\"; }  #pty_finePrint { \tfont-size: 11px; \tmargin-right: 48px; \tmargin-top: -37px; \tfont-style: italic; \tposition: absolute; \tleft: 7px; \tbottom: -11px; }  #pty_pkg .pty_input { \tdisplay: block; \tfont-size: 24px; \tfont-family: \"PTSansBold\"; \twidth: 249px; \tcolor: #ADADAD; \theight: 79px; \tpadding: 0 27px; \tmargin-bottom: -23px; \tbackground: url(\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/input.png) no-repeat scroll 0 0 transparent; \tline-height: 320%; }  #pty_submit { \tpadding-top: 0; \tborder: 0 none; \ttext-align: center; \tfont-size: 27px; \twidth: 296px; \tfont-family: \"PTSansBoldItalic\"; \tmargin-left: -1px; \tcolor: #E8FFFD; \ttext-shadow: 1px 1px 1px #668BA2; \tbackground-repeat: no-repeat; \theight: 78px; \tpadding-bottom: 3px; \tmargin-top: 1px; }  #pty_mainText ul li { \tbackground-repeat: no-repeat; \tposition: relative; \tleft: 0; \tfont-size: 20px; \tpadding-left: 33px; \theight: 50px; \tmargin-top: 6px; \tmargin-bottom: -23px; \tpadding-top: 4px; \tfont-family: inherit; }  #pty_close { \tdisplay: block; \tposition: absolute; \tz-index: 1000; \tbackground: url(\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/close.png) no-repeat scroll 0 0 transparent; \tcolor: #898989; \tfont-family: \"PTSansBold\"; \ttext-shadow: 1px 1px 1px #FFFFFF; \ttop: -29px; \theight: 40px; \tline-height: 215%; \twidth: 40px; \tpadding-left: 16px; \tright: -41px; }  #pty_close:hover { \tcolor: #888888; }  #pty_concrete { \tposition: relative; }  #pty_right { \tfloat: right; \tposition: relative; \theight: 339px; \twidth: 294px; \tmargin-right: 8px; \tz-index: 1000000; }  #pty_sideText { \tline-height: 140%; \ttext-align: center; \tfont-family: \"PTSansBold\"; \tfont-size: 16pt; \tcolor: #FFFFFF; \tpadding: 9px 0; \ttext-shadow: -1px -1px 1px rgba(40, 40, 40, 0.3); }  #pty_sideBottomLine { \twidth: 100%; \theight: 1px; \tborder-top: 1px solid #F1F0EB; }  #pty_sideHeading { \tline-height: 100%; \tfont-family: \"PTSansBold\"; \tfont-size: 22pt; \tcolor: #FFFCFC; \ttext-align: center; \tmargin-top: 8px; \ttext-shadow: -1px -1px 1px rgba(40, 40, 40, 0.3); }  ","html":"<div id=\"pty_smooth\" class=\"pty_background\">\t<div id=\"pty_smoothInner\">\t\t<a href=\"#\" id=\"pty_close\">x<\/a>\t\t<div id=\"pty_right\">\t\t\t<div id=\"pty_sideHeading\"><\/div>\t\t\t<div id=\"pty_sideText\"><\/div>    \t\t\t<form id=\"pty_form\">\t\t\t\t<input type=\"text\" class=\"pty_input\" id=\"pty_name\" value=\"Name\"\/>\t\t\t\t<input type=\"text\" class=\"pty_input\" id=\"pty_email\" value=\"E-Mail\"\/>\t\t\t\t<input type=\"submit\" id=\"pty_submit\" value=\"Sign-Up!\" class=\"pty_submit\"\/>\t\t\t<\/form>  \t\t<\/div>\t\t<div id=\"pty_content\">\t\t\t<div id=\"pty_heading\"><\/div> \t\t\t<div id=\"pty_mainImageShell\"><\/div>\t\t\t<div id=\"pty_mainText\"><\/div>\t\t<\/div>\t\t<div id=\"pty_afflinkShell\">\t\t\t<a href=\"#\" id=\"pty_afflink\"><\/a>\t\t<\/div>\t<\/div><\/div>","js":"","img":"\/www\/wp-content\/plugins\/pippity\/themes\/dimensional\/dimensional.png","url":"\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/","status":1,"imgUrl":"\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/dimensional.png","label":"Examples book pippity","popupid":"14","preload":["\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/background_pink.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/background_plum.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/bullet_pink.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/bullet_plum.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/close.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/input.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/submit_pink.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/submit_plum.png","http:\/\/contentmarketinginstitute.com\/wp-content\/uploads\/2016\/11\/2016-Examples-ebook-cover_pippity.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/background__orange.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/bullet__orange.png","\/\/contentmarketinginstitute.com\/wp-content\/plugins\/pippity\/themes\/dimensional\/images\/submit__blue.png"],"families":["Georgia","PTSansBoldItalic","PTSansBold","inherit"],"styleCopy":{"heading":{"color":"#555555","font_family":"AurulentSansBold","font_size":"42px"},"mainText":{"color":"#63410e","font_family":"AurulentSansRegular","font_size":"27px"},"sideHeading":{"color":"#fffcfc","font_family":"PTSansBold","font_size":"36px"},"sideText":{"color":"#ffffff","font_family":"PTSansBold","font_size":"18px"},"name":{"color":"#c7a210","font_family":"PTSansBold","font_size":"24px"},"email":{"color":"#c7a210","font_family":"PTSansBold","font_size":"24px"},"submit":{"color":"#e8fffd","font_family":"PTSansBoldItalic","font_size":"27px"}},"customCss":"#pty_input-hp_empty {\n  display: none !important;\n}","settings":{"delay":"15","visits":"1","expire":"60","trigger":"0","mouseout":"1","blur":"0","fade":"0","animate":"0","ajaxSubmit":"0","new_page":"0","postOnly":"1","loggedOutOnly":"0","customCookie":"visited","priority":"0","loaded":"","open":"jQuery(\"#pty_form input[name=ao_refurl]\").val(window.location.href);\njQuery(\"#pty_form input[name=hp_empty\").val(\"\");","closed":"","submitted":""},"overlay":{"background":"#000000","opacity":"0.75"},"step":"4","usingPowerFilters":"false","customForm":"","cookie":"pty_visited","form":{"action":"http:\/\/contentmarketinginstitute.com\/wp-admin\/admin-post.php","hidden":[{"name":"Original Source","value":"Pippity Test"},{"name":"Daily Alert","value":"True"},{"name":"ao_refurl","value":"\"'"},{"name":"ext_post_url","value":"http:\/\/info.contentmarketinginstitute.com\/acton\/eform\/5141\/0008\/d-ext-0001"},{"name":"action","value":"cmi_ext_post"},{"name":"return_url","value":"http:\/\/contentmarketinginstitute.com\/thank-you-for-signing-up-weekly-enewsletter-cm-examples-ebook\/"},{"name":"ga_label","value":"Pippity"}],"type":"mailchimp","email":"E-mail Address","name":"First Name","custom_fields":[{"pre":"name"},{"pre":"email"},{"label":"Label","name":"hp_empty"}]},"events":{"submitted":"","loaded":"","open":"jQuery(\"#pty_form input[name=ao_refurl]\").val(window.location.href);\njQuery(\"#pty_form input[name=hp_empty\").val(\"\");"},"filters":[]};
						
				/*
 * Renders Popup HTML
 */
window.$j = jQuery;
if (pty.theme !== undefined && pty.theme.events !== undefined && pty.theme.events) {
	$j.each(pty.theme.events, function(ev, action){
		pty.add_hook(ev, function(){
			eval(_pty.stripSlashes(action));
		});
	});
}
pty.mouseout_confirmed = false
pty.lastX = 0;
pty.lastY = 0;
pty.mouseout_confirm = function(e) {
	var x = e.clientX;
	var y = e.clientY;
	if (x > pty.lastX) {
		moving_left = true;
		moving_right = false;
	}
	else {
		moving_right = false;
		moving_left = true;
	}
	if (y > pty.lastY) {
		moving_up = false;
		moving_down = true;
	}
	else {
		moving_up = true;
		moving_down = false;
	}
	pty.mouseout_confirmed = false
	if (($j(window).width() - x) > 50 || !moving_left) {
		if (moving_up && y < 50) {
			pty.mouseout_confirmed = true
		}
		if (moving_left && x < 50) {
			pty.mouseout_confirmed = true
		}
		if (moving_down && y > $j(window).height() - 50) {
			pty.mouseout_confirmed = true
		}
	}
	pty.lastX = x;
	pty.lastY = y;
};
pty.open_via_mouseout = function(e){
	if (pty.mouseout_confirmed) {
		pty.open();
	}
};
pty.open_handler = function(){
	pty.open();
};
pty.build = function(){
	if (pty.theme.animate === undefined) {
		pty.theme.animate = 0;
	}
	pty.loadJs();
	$j('#pty_pkg').remove();
	$j('#pty_styles').remove();
	var popup = $j('<div id="pty_pkg" class="pty_pkg"/>')
		.hide()
		.prependTo('body');

	//Main HTML
	popup
		.append('<div id="pty_overlay"/>')
		.append('<div id="pty_popup"></div>');
	$j('#pty_popup', popup).html(_pty.stripSlashes(pty.theme.html));
	if (pty.theme.button !== undefined) {
		$j('#pty_submit', pty.frame).addClass(pty.theme.button+'-button');
	}

	if (PTY_AFFLINK !== "" && PTY_AFFTEXT !== "") {
		if (!$j('#pty_afflink').length) {
			$j('#pty_pkg').append('<a id="pty_afflink" href="#" target="_blank"></a>');
		}
		$j('#pty_afflink').attr('href', PTY_AFFLINK).html(PTY_AFFTEXT).show().css('display', 'inline');
	}
	else {
		$j('#pty_afflink', pty.frame).remove();
	}
	pty.buildForm();
	pty.addCss();
	pty.addCopy();
	pty.applyStyledImages();
	pty.applyStyledText();
	pty.applyCustomCss();
	pty.applyCustomForm();
	pty.do_hook('built');
	pty.position();
	pty.submitted = false;
	var submit = function() {
		if(!pty.submitted) {
			pty.do_hook('submit_start');
			if (!$j('#pty_form #pty_email:visible').length || $j('#pty_form #pty_email').val().indexOf('@') > -1) {
				pty.submitted = true;
				if (!pty.testLoad()) {
					pty.createCookie(pty.cookie(), 'visited', 1000);
				}
				if (pty.theme.notify !== undefined && pty.theme.notify.length) {
					fields = {}
					fields.email = {
						label: 'E-Mail Address',
						value: $j('#pty_form #pty_email:visible').val(),
					};
					fields.name = {
						label: 'Name',
						value: $j('#pty_form #pty_name:visible').val(),
					};
					if (pty.theme.form.custom_fields !== undefined) {
							$j.each(pty.theme.form.custom_fields, function(i, v){
								if (typeof v.pre === 'undefined' ) {
									fields[v.name] = {
										label: v.label,
										value: $j('#pty_input-'+v.name).val()
									};
								}
							});
					}
					var post = {
						fields: fields,
						popupid: pty.theme.popupid
					};
					_pty.send('notify', post);
				}
				pty.do_hook('submitted');
				pty.markImp('convertTime');
				pty.unload();
				if (pty.theme.settings.ajaxSubmit !== undefined && parseInt(pty.theme.settings.ajaxSubmit) > 0) {
					pty.ajaxSubmit();
					return false;
				}
				if(pty.theme.settings.new_page !== undefined && +pty.theme.settings.new_page){
					pty.close();
				}
			}
			else {
				em = $j('#pty_email');
				em.fadeTo(150, '.4', function(){
					em.fadeTo(150, '1', function(){
						em.fadeTo(150, '.4', function(){
							em.fadeTo(150, '1', function(){
							});
						});
					});
				});
				pty.do_hook('insufficient_values');
				return false;
			}
		}
	};
	$j('#pty_form').submit(submit);
	$j('.pty_submit, .pippity_submit')
		.submit(submit)
		.click(submit);
	$j('.pippity_custom_submit')
		.submit(submit)

};
pty.ajaxSubmit = function() {
	var post = {};
	post = _pty.formToJson('pty_form');
	var url = pty.theme.form.action;
	if (pty.theme.form.type == 'wysija') {
		url = PTY_AJAX;
		post.action = 'pty_wysija_submit';
		post.incoming_ajax = true;
	}
	$j.post(url, post);
	em = $j('#pty_submit');
	em.fadeTo(450, '.4', function(){
		em.fadeTo(450, '1', function(){
			em.fadeTo(450, '.4', function(){
				em.fadeTo(450, '1', function(){
					em.val('✔').css('font-family', 'arial,helvetica,sans-serif');
					setTimeout(function() {
					pty.close();
					}, 750);
				});
			});
		});
	});
};
pty.testLoad = function() {
	if ((pty.now !== undefined && pty.now) || (pty.testing !== undefined && pty.testing)) {
		return true;
	}
	return false;
};
pty.loadJs = function() {
	if (pty.hooks === undefined) {
		pty.hooks = {};
	}
	if (pty.theme.js !== undefined && pty.theme.js.length > 0) {
		eval(pty.theme.js);
		pty.do_hook('js_loaded');
	}
	else {
		pty.do_hook('no_js');
	}
};
pty.loadPopupFonts = function(id) {
	var fonts = [];
	var theme = pty.themes[id];
	if (theme.fonts !== undefined) {
		$j.each(theme.fonts, function(i, v){
			if (!$j('#pty_font_'+v, pty.frame).length) {
				fonts.push(v);
			}
		});
		if (fonts.length) {
			fonts = fonts.join(',');
			var key = PTY_KEY;
			var fontUrl = 'https://pippity.com/get_f_asset.php?fonts='+fonts;
			if (PTY_URL.indexOf('https://') === 0) {
				fontUrl = fontUrl.replace(/http:\/\//g, 'https://');
			}
			var loaded = function(){
				pty.isReady('fonts-'+id);
				var c = 0;
				$j.each(theme.families, function(i, v){
					c++;
					$j('body').append('<div class="pty_fontload"  style="position:absolute; top:-9999px; left:-9999px;" id="pty_fontload_'+c+'" style="font-family:'+v+'"></div>');
				});
				setTimeout(function(){
					$j('.pty_fontload').hide();
				}, 1500);
			};
			var link = document.createElement('link');
				link.type = 'text/css';
				link.rel = 'stylesheet';
				link.href = fontUrl;
			document.getElementsByTagName('head')[0].appendChild(link);
			var img = document.createElement('img');
			img.onerror = function(){
				loaded();
				document.body.removeChild(img);
			};
			document.body.appendChild(img);
			img.src = fontUrl;
		}
		else {
			pty.isReady('fonts-'+id);
		}
	}
	else {
			pty.isReady('fonts-'+id);
		}
};
pty.preload = function() {
	$j('body').append('<div id="pty_preload"></div>');
	$j('#pty_preload').attr('style', 'position:absolute; top:-9999px; left:-9999px');
	if (pty.autoid !== undefined) {
		pty.preloadPopup(pty.autoid);
		pty.loadPopupFonts(pty.autoid);
	}
	$j.each(pty.themes, function(id, theme) {
		if (theme !== undefined && id !== pty.autoid) {
			pty.preloadPopup(id);
			pty.loadPopupFonts(id);
		}
	});
};
pty.preloadPopup = function(id) {
	$j.each(pty.themes[id].preload,
		function(i, v){
			$j('#pty_preload').append('<img src="'+v+'"/>');
		});
};
pty.buildForm = function() {
	if (pty.designing || pty.theme.form === undefined || !pty.theme.form) {
		return false;
	}
	if (pty.theme.form.action !== undefined) {
		$j('#pty_form')
			.attr('method', 'post')
			.attr('action', pty.theme.form.action);
	}
	if (pty.theme.form.name !== undefined) {
		$j('#pty_name').attr('name', pty.theme.form.name);
	}
	if (pty.theme.form.email !== undefined) {
		$j('#pty_email').attr('name', pty.theme.form.email);
	}
	if (pty.theme.form.stats !== undefined) {
		$j('body').append('<img src="'+pty.theme.form.stats+'" style="position:absolute; top:-9999px; left:-9999px"/>');
	}
	if (pty.theme.form.hidden !== undefined) {
		$j.each(pty.theme.form.hidden, function(i, v){
			if (v.value == '<<empty>>') {
				v.value = '';
			}
			$j('#pty_form').append('<input type="hidden" name="'+v.name+'" value="'+v.value+'"/>');
		});
	}
	if(pty.theme.settings.new_page !== undefined && +pty.theme.settings.new_page){
		$j('#pty_form').attr('target', '_blank');
	}
	pty.buildCustomFields();
};
pty.buildCustomFields = function() {
	var cstm = $j('#pty_custom_fields', pty.frame);
	if (pty.theme.form.custom_fields !== undefined && pty.theme.form.custom_fields.length) {
		var html = '';
		var fields = {};
		$j('.pty_custom_field', pty.frame).remove();
		if (!cstm.length) {
			cstm = $j('<div/>', pty.frame).attr('id', 'pty_custom_fields');
			cstm.insertBefore($j('input', pty.frame).eq(0));
		}
		$j.each(pty.theme.form.custom_fields, function(i, field) {
			if (field.label !== undefined) {
				var elm = $j('<input/>')
					.attr('type', 'text')
					.attr('class', 'pty_input pty_custom_field')
					.attr('id', 'pty_input-'+field.name)
					.attr('name', field.name)
					.labeledInput(field.label);
				elm.insertBefore(cstm);
				fields[field.name] = field.label;
			}
			else {
				var mv_field = $j('#pty_'+field.pre, pty.frame);
				var nw = mv_field.clone();
				nw.insertBefore(cstm);
				mv_field.remove();
			}
		});
	}
	cstm.remove();
};
pty.addCss = function() {
	pty.theme.css += "#pty_overlay{ position:fixed; z-index:100000000; height:100%; width:100%; top:0; } #pty_popup{ position:fixed; z-index:1000000001; }";
	if (PTY_URL.indexOf('https://') === 0) {
		pty.theme.css = pty.theme.css.replace(/http:\/\//g, 'https://');
	}
	head = document.head || document.getElementsByTagName('head')[0],
    style = document.createElement('style');
    style.type = 'text/css';
    style.id = 'pty_styles';
	if (style.styleSheet){
	  style.styleSheet.cssText = pty.theme.css;
	} else {
	  style.appendChild(document.createTextNode(pty.theme.css));
	}
	head.appendChild(style);
	$j('#pty_close').css('z-index', '10000');
	$j('#pty_form').css('z-index', '10000');
};
pty.addCopy = function() {
	var slashGex = new RegExp(/(\\+)'/);
	$j.each(pty.theme.copy, function(i, v){
		if (v.type == 'image') {
			if (v.src.length) {
				$j('#pty_'+i+'Shell', pty.frame).append(
					'<img src="'+v.src+'" id="pty_'+i+'"/>'
				);
			}
		}
		else if (v.type != 'submit' && v.type != 'field'){
			var copy = v.text !== undefined ? v.text : '';
			copy = _pty.stripSlashes(copy).replace(slashGex, "'");
			if (v.type == 'html') {
				copy = pty.parseCopy(copy);
			}
			if (typeof v.image == 'string') {
				copy = '<img src="'+v.image+'" id="pty_image-'+i+'" class="pty_image"/>' + copy;
			}
			$j('#pty_'+i, pty.frame).html(copy);
		}
	});
	$j('#pty_name').val('').labeledInput(_pty.stripSlashes(pty.theme.copy.name.text).replace(slashGex, "'"));
	$j('#pty_email').val('').labeledInput(_pty.stripSlashes(pty.theme.copy.email.text).replace(slashGex, "'"));
	$j('#pty_submit').val(_pty.stripSlashes(pty.theme.copy.submit.text).replace(slashGex, "'"));
	pty.do_hook('copy_added');
};
pty.parseCopy = function(copy) {
	var lines = copy.split('\n');
	var output = '';
	var inList = false;
	$j.each(lines, function(i, v){
		var isBullet = false;
		if (v.indexOf('*') === 0) {
			isBullet = true;
		}
		if (!inList && isBullet) {
			output += "<ul>";
			inList = true;
		}
		if (isBullet) {
			output += '<li class="pty_bullet">'+v.replace('*', '')+'</li>';
		}
		if (inList && !isBullet) {
			output += "</ul>";
			inList = false;
		}
		if (!inList) {
			output += v+'<br/>';
		}
	});
	return output;
};
pty.events = function() {
	//Events
	$j(document).on('click', '#pty_close', pty.close);
	$j(document).on('click', '.pty_close', pty.close);
	$j(document).on('click', '.pty_convert', pty.convertTrigger);
	$j(document).on('click', '#pty_popup-submit', pty.clickSubmitHandler);
	$j(document).on('click', '.pty_click', pty.clickHandler);
	$j(document).on('click', '.pty_click a', pty.clickHandler);
	$j(document).on('click', '#pty_overlay', pty.close);
	$j(window).blur(function(){pty.markImp('blurTime');});
	$j(window).focus(function(){pty.markImp('focusTime');});
	$j(window).keyup(pty.keywatch);
};
pty.clickSubmitHandler = function() {
	$j('#pty_form').submit();
	return false;
};
pty.clickHandler = function(){

	var id = pty.getID($j(this));
	pty.open(id);
	if (pty.theme !== undefined && pty.theme.events !== undefined && pty.theme.events) {
		$j.each(pty.theme.events, function(ev, action){
			pty.add_hook(ev, function(){
				eval(_pty.stripSlashes(action));
			});
		});
	}
	return false;
};

/*
 * Position popup
 */
pty.position = function(hide){
	if (hide === undefined) {
		hide = true;
	}
	var win = $j(window);
	$j('#pty_pkg').show();
	pty.do_hook('position_start');
	var dialogWidth = $j('#pty_popup', pty.frame).width();
	var dialogHeight = $j('#pty_popup', pty.frame).outerHeight();
	if (hide) {
		$j('#pty_pkg').hide();
	}
	var x = pty.theme.x;
	var y = pty.theme.y;
	if (!parseInt(pty.theme.animate)) {
		pty.theme.startX = false;
		pty.theme.startY = false;
	}
	if (pty.theme.startX !== undefined && pty.theme.startX) {
		x = pty.theme.startX;
	}
	if (pty.theme.startY !== undefined && pty.theme.startY) {
		y = pty.theme.startY;
	}

	// Get dimensions
	var dialogLeft = pty.getPositionDim(x, win.width(), dialogWidth, 'x');
	var dialogTop = pty.getPositionDim(y, window.innerHeight, dialogHeight, 'y');
	if(pty.isIE6){
		dialogTop = $j(window).scrollTop() + (win[1]/2) - (dialogHeight/2);
		$j('#pty_popup', pty.frame).css('position', 'absolute');
	}
	if (dialogTop.pos < 10 && +pty.theme.hideFlash !== 0) {
		dialogTop.pos = 10 + $j(window).scrollTop();
		$j('#pty_popup', pty.frame).css('position', 'absolute');
	}
	$j('#pty_popup', pty.frame)
		.css(dialogTop['place'], dialogTop['pos'] + 'px')
		.css(dialogLeft['place'], dialogLeft['pos'] + 'px')
		.addClass('pty_pos_y_'+dialogTop['place'])
		.addClass('pty_pos_x_'+dialogLeft['place']);
	pty.do_hook('positioned');
};
pty.getPositionDim = function(position, winDim, boxDim, axis){
	var dim = 0;
	var place = '';
	switch(position){
		case 'center':
			dim = (winDim/2) - (boxDim/2);
			place = axis == 'x' ? 'left' : 'top';
			break;
		case 'left':
		case 'top':
			dim = ($j('#wpadminbar').length && position == 'top') ? 28 : 0;
			place = axis == 'x' ? 'left' : 'top';
			break;
		case 'right':
		case 'bottom':
			dim = 0;
			place = axis == 'x' ? 'right' : 'bottom';
			break;
		case 'wideleft':
		case 'above':
			dim = 0 - boxDim - 4;
			place = axis == 'x' ? 'left' : 'top';
			break;
		case 'wideright':
		case 'below':
			dim = 0 - boxDim - 4;
			place = axis == 'x' ? 'right' : 'bottom';
			break;
		default:
			dim = position.replace('px', '');
			place = axis == 'x' ? 'left' : 'top';
			break;
	}
	return {place: place, pos: dim};
};
pty.open = function(id) {
	if (id === undefined) {
		if (pty.autoid !== undefined) {
			id = pty.autoid;
		}
		else {
			return false;
		}
	}
	// Unbind all triggers
	clearTimeout(pty.mainTimo);
	$j(window).unbind('scroll', pty.trigger);
	$j(window).unbind('blur', pty.open_handler);
	$j(document).off('mouseleave', 'html', pty.open_via_mouseout);

	pty.theme = pty.themes[id];
	pty.popupid = id;
	pty.ready('fonts-'+id, function(){
		// Add to HTML
		pty.build();

		// Setup Overlay, it should work even if only set in CSS
		if (pty.theme.overlay === undefined) {
			pty.theme.overlay = {};
			pty.theme.overlay.background = $j('#pty_overlay').css('background-color');
			pty.theme.overlay.opacity = $j('#pty_overlay').css('opacity');
		}
		$j('#pty_overlay', pty.frame)
			.css('background-color', pty.theme.overlay.background)
			.fadeTo(0, pty.theme.overlay.opacity);

		// Fading In
		if (pty.theme.settings.fade !== undefined && parseInt(pty.theme.settings.fade) && pty.theme.overlay.opacity > 0) {
			$j('#pty_pkg #pty_overlay', pty.frame).css('opacity', 0);
			$j('#pty_pkg #pty_popup', pty.frame).css('opacity', 0);
			$j('#pty_pkg', pty.frame).show();
			if (pty.theme.noOverlay === undefined && !pty.theme.noOverlay) {
				var overlayOpacity = $j('#pty_pkg #pty_overlay', pty.frame).show().css('opacity', '');
				$j('#pty_overlay', pty.frame).animate( {opacity: pty.theme.overlay.opacity},
					{
						queue: false,
						duration: 100,
						complete: function(){
							pty.do_hook('overlayFadedIn');
						}
					}
				);
			}
			else {
				$j('#pty_overlay').hide();
			}
			$j('#pty_popup', pty.frame).animate( {opacity: 1},
				{
					queue: false,
					duration: 400,
					complete: function(){
						pty.do_hook('open');
					}
				}
			);
			pty.do_hook('fadeIn');
		}

		// Popping In
		else {
			$j('#pty_pkg', pty.frame).show();
			if ((pty.theme.noOverlay !== undefined && pty.theme.noOverlay) || +pty.theme.opacity === 0) {
				$j('#pty_overlay', pty.frame).hide();
			}
			pty.do_hook('open');
		}
		pty.animate();
		pty.addImp();
		if ( pty.theme.hideFlash === undefined) {
			pty.theme.hideFlash = 1;
		}
	});
	return false;
};
pty.animate = function(){
	var win = $j(window);
	var dialogWidth = $j('#pty_popup', pty.frame).width();
	var dialogHeight = $j('#pty_popup', pty.frame).outerHeight();
	var isAnimated = false;
	if (pty.theme.animate !== undefined && parseInt(pty.theme.animate)) {
		var animations = {};
		if (pty.theme.startX !== undefined && pty.theme.startX) {
			var dimX = pty.getPositionDim(pty.theme.x, win.width(), dialogWidth, 'x');
			animations[dimX['place']] = dimX['pos'];
			isAnimated = true;
		}
		if (pty.theme.startY !== undefined && pty.theme.startY) {
			var dimY = pty.getPositionDim(pty.theme.y, win.height(), dialogHeight, 'y');
			animations[dimY['place']] = dimY['pos'];
			isAnimated = true;
		}
		if (isAnimated) {
			pty.do_hook('animationStarted');
			$j('#pty_popup', pty.frame).animate(animations, {
				queue: false,
				duration: 300,
				complete: function(){
					pty.do_hook('animationDone');
				}
			});
		}
	}
	return true;
};
pty.close = function() {
	if (!pty.testLoad()) {
		pty.createCookie(pty.cookie(), 'visited', pty.theme.settings.expire);
	}
	if (pty.theme.settings.fade !== undefined && parseInt(pty.theme.settings.fade)) {
		$j('#pty_overlay', pty.frame).animate( {opacity: 0},
			{
				queue: false,
				duration: 100,
				complete: function(){
					pty.do_hook('overlayFadedOut');
				}
			}
		);
		$j('#pty_popup', pty.frame).animate( {opacity: 0},
			{
				queue: false,
				duration: 300,
				complete: function(){
					$j('#pty_pkg').hide();
					pty.do_hook('closed');
				}
			}
		);
		pty.do_hook('fadeOut');
	}
	else {
		$j('#pty_pkg', pty.frame).hide();
		pty.do_hook('closed');
	}
	pty.markImp('closeTime');
	return false;
};
pty.keywatch = function(e) {
	if (e.keyCode == 27) {
		pty.close();
	}
};

/*
 * Apply Style
 */
pty.applyStyledImages = function(){
	if (pty.theme.styleImgs !== undefined) {
		$j.each(pty.theme.styleImgs, function(i, v){
			var imgUrl= pty.theme.url + 'images/'+ i + '__' + v + '.png';
			if (PTY_URL.indexOf('https://') === 0) {
				imgUrl = imgUrl.replace(/http:\/\//g, 'https://');
			}
			$j('.pty_'+i, pty.frame).css('background-image', 'url('+imgUrl+')');
		});
	}
};
pty.applyStyledText = function(){
	if (pty.theme.styleCopy !== undefined) {
		$j.each(pty.theme.styleCopy, function(elm, props){
			$j.each(props, function(prop, val){
				prop = prop.replace('_', '-');
				if (prop == 'font-family') {
					val = '"'+val+'"';
				}
				if (prop == 'font-size') {
					$j('#pty_'+elm+ ' .pty_bullet', pty.frame).css(prop, val);
				}
				$j('#pty_'+elm, pty.frame).css(prop, val);
				if (elm == 'email') {
					$j('.pty_custom_field', pty.frame).css(prop, val);
				}
			});
		});
	}
};
pty.applyCustomCss = function(){
	if (pty.theme.customCss !== undefined) {
		$j('body').append('<style id="pty_customCss" type="text/css">'+_pty.stripSlashes(pty.theme.customCss)+'</style>');
	}
};
pty.applyCustomForm = function(){
	if (pty.theme.customForm!== undefined) {
		var html = _pty.stripSlashes(pty.theme.customForm);
		if (typeof html == 'string' && html.length) {
			var form = $j('#pty_form', pty.frame);
			if (html.length > 0) {
				html = $j('<div/>').attr('id', 'pty_customFormShell').html(html);
				innerForm = $j('form', html);
				if (!innerForm.hasClass('pippity_custom_submit')) {
					innerForm.addClass('pippity_custom_submit');
				}
				form.before(html);
				form.hide();
			}
		}
	}
};

/**
 * Determines whether to use timedOpen or if there are comments on the page
 */
pty.start = function(){
	if (pty.theme === undefined || !pty.theme) {
		return false;
	}
	// Don't Open if set to only post pages
	if (parseInt(pty.theme.settings.postOnly) && !PTY_ISPOST) {
		return false;
	}
	pty.cval = pty.readCookie(pty.cookie());

	// Don't Open if visited
	if (pty.cval === 'visited') {
		return false;
	}

	// Don't open if not enough visits
	var cval = (pty.cval) ? parseInt(pty.cval) + 1 : 1;
	if (cval < pty.theme.settings.visits) {
		pty.createCookie(pty.cookie(), cval, 365);
		return false;
	}
	pty.build();
	var trig = false;
	if ($j('#pty_trigger').length) {
		trig = pty.theme.settings.trigger*1;
		pty.endY = $j('#pty_trigger').offset().top;
	}
	var win = $j(document).height();
	if(pty.endY > win || !trig){
		pty.timedOpen(pty.theme.settings.delay * 1000);
	}
	else if(trig){
		$j(window).scroll(pty.trigger);
	}

	// Show popup on mouseout
	if(pty.theme.settings.mouseout * 1) {
		$j(document).on('mouseleave', 'html', pty.open_via_mouseout);
		$j(window).on('mousemove', pty.mouseout_confirm);
	}

	// Show popup on page blur
	if(pty.theme.settings.blur * 1) {
		$j(window).blur(pty.open_handler);
	}
};

/**
 * Pulls the trigger when user has scrolled to set point
 */
pty.trigger = function(){
	pty.endY = $j('#pty_trigger').offset().top;
	if($j(window).scrollTop() > (pty.endY - $j(window).height())){
		pty.open();
	}
};

/**
 * Opens popup based on passed milliseconds
 */
pty.timedOpen = function(s){
	pty.mainTimo = setTimeout(function(){pty.open();}, s);
};
/*
 * Analytics
 */
pty.unloaded = false;
pty.initUnload = function(){
	var i = document.createElement('iframe');
	i.src='';
	i.style.cssText = 'position:absolute; left:-9999px; top:-9999px;';
	document.getElementsByTagName('body')[0].appendChild(i);
	pty.unload = function(){
		if (!pty.unloaded) {
			pty.unloaded = true;
			pty.markImp('leaveTime', function(){
				var imp = $j.base64.encode((encodeURIComponent(JSON.stringify(pty.impression))));
				var AJAX= new XMLHttpRequest();
				AJAX.onreadystatechange = function(){if (AJAX.readyState!=4) {return false;}};
				AJAX.open("GET", PTY_AJAX+"?incoming_ajax=true&action=pty_recordImpression&imp="+imp, false);
				AJAX.send(null);
			});
		}
	};
	if (navigator.userAgent.indexOf('AppleWebKit/') > -1) {
		i.contentWindow.window.onunload=pty.unload;
		window.onbeforeunload=function(){
			var x=document.getElementsByTagName('iframe')[0];
			x.parentNode.removeChild(x);
		};
	} else {
		i.contentWindow.window.onbeforeunload=pty.unload;
		window.onbeforeunload = pty.unload;
	}
};
pty.impression = {};
pty.addImp = function() {
	pty.impression = {popupid: pty.popupid, page: location.href};
	var now = Math.floor((new Date()).getTime() / 1000);
	pty.impression.startTime = now;
	pty.impression.closeTime = 0;
	pty.impression.leaveTime = 0;
	pty.impression.closeTime = 0;
	pty.impression.convertTime = 0;
	pty.impression.blurTime = 0;
	pty.initUnload();
};
pty.convertTrigger = function () {
	pty.createCookie(pty.cookie(), 'visited', 1000);
	pty.markImp('convertTime');
	pty.unload();
};
pty.markImp = function(type, cb) {
	var start = pty.impression.startTime;
	pty.impression.type = type;
	var now = Math.floor((new Date()).getTime() / 1000);
	switch(type) {
		case 'leaveTime':
			pty.impression.leaveTime = now - start;
			if (!pty.impression.closeTime) {
				pty.impression.closeTime = now - start;
			}
		break;
		case 'closeTime':
			pty.impression.closeTime = now - start;
		break;
		case 'blurTime':
			pty.blurStart = now;
		break;
		case 'focusTime':
			if(pty.blurStart > 0) {
				pty.impression.blurTime += (now - pty.blurStart);
				pty.blurStart = 0;
			}
		break;
		case 'convertTime':
			pty.impression.leaveTime = now - start;
			pty.impression.convertTime = now - start;
			pty.impression.closeTime = now - start;
		break;
	}
	if (cb !== undefined) {
		cb();
	}
};
pty.createCookie = function(name, value, days){
	var expires = '';
	if(days){
		var date = new Date();
		date.setTime(date.getTime()+(days*24*60*60*1000));
		expires = "; expires="+date.toGMTString();
	}
	else{
		expires = "";
	}
	value = escape(value);
	document.cookie = name+"="+value+expires+"; path=/";
};
pty.readCookie = function(name){
	name = name + "=";
	var ca = document.cookie.split(';');
	for(var i=0;i < ca.length;i++) {
		var c = ca[i];
		while (c.charAt(0)==' ') c = c.substring(1,c.length);
		if (c.indexOf(name) === 0) return(unescape(c.substring(name.length,c.length)));
	}
	return false;
};
pty.cookie = function() {
	return pty.theme.cookie !== undefined && pty.theme.cookie.length ? pty.theme.cookie : 'pty_visited';
};

/*
 * Readys
 */
pty.readys = {};
pty.ready = function(id, fnc) {
	if (pty.readys[id] === undefined) {
		pty.readys[id] = {ready: false, fnc: false};
	}
	if(typeof pty.readys[id] == 'function'){
		pty.readys[id].fnc = function(){
			pty.readys[id];
		};
	}
	else{
		pty.readys[id].fnc = function(){
			fnc();
		};
	}
	if (pty.readys[id].ready) {
		pty.doReady(id);
	}
};
pty.isReady = function(id) {
	if (pty.readys[id] !== undefined) {
		pty.readys[id].ready = true;
		pty.doReady(id);
	}
	else{
		pty.readys[id] = {ready: true, fnc: false};
	}
};
pty.doReady = function(id) {
	pty.readys[id].fnc();
	pty.readys[id].fnc = null;
};

/*
 * Globals
 */
pty.endY = 0;
pty.blurStart = 0;
pty.designing = false;
pty.frame = document;

/*
 * Smart label inputs
 */
 $j.fn.labeledInput = function(val, opts){
	$j(obj).unbind('focus').unbind('blur');
	if(opts === undefined){
		opts = {};
	}
	if (opts.focusText === undefined){
		opts.focusText = '';
	}
	if (typeof opts.focusText == 'function'){
		opts.focusText = opts.focusText();
	}
	var obj = this;
	if(obj.val() === '' || opts.forceChange){
		obj.val(val);
		obj.addClass('labeledInput-clear');
		if(opts.init !== undefined){
			opts.init();
		}
	}
	obj
	.focus(function(){
		if(obj.val() == val){
			obj.val(opts.focusText);
			obj.removeClass('labeledInput-clear');
			obj.addClass('labeledInput-active');
			if(opts.activated !== undefined){
				opts.activated();
			}
		}
	})
	.blur(function(){
		if (obj.val() == opts.focusText) {
			obj.val(val);
			obj.addClass('labeledInput-clear');
			obj.removeClass('labeledInput-active');
			if (opts.cleared !== undefined) {
				opts.cleared();
			}
		}
	});
	return this;
  };
(function($j) {
	if ( $j.fn.on === undefined) {
		$j.fn.on = function(events, selector, data, handler){
			$j(this).delegate(selector, events, data, handler);
			return this;
		}
	}
})(jQuery);

(function($j) {
	if ( $j.fn.off === undefined) {
		$j.fn.off = function(events, selector, data, handler){
			$j(this).undelegate(selector, events, data, handler);
			return this;
		}
	}
})(jQuery);

jQuery.base64=(function($){var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION="1.0";function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1){throw"Cannot decode base64"}return idx}function _decode(s){var pads=0,i,b10,imax=s.length,x=[];s=String(s);if(imax===0){return s}if(imax%4!==0){throw"Cannot decode base64"}if(s.charAt(imax-1)===_PADCHAR){pads=1;if(s.charAt(imax-2)===_PADCHAR){pads=2}imax-=4}for(i=0;i<imax;i+=4){b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12)|(_getbyte64(s,i+2)<<6)|_getbyte64(s,i+3);x.push(String.fromCharCode(b10>>16,(b10>>8)&255,b10&255))}switch(pads){case 1:b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12)|(_getbyte64(s,i+2)<<6);x.push(String.fromCharCode(b10>>16,(b10>>8)&255));break;case 2:b10=(_getbyte64(s,i)<<18)|(_getbyte64(s,i+1)<<12);x.push(String.fromCharCode(b10>>16));break}return x.join("")}function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return x}function _encode(s){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0){return s}for(i=0;i<imax;i+=3){b10=(_getbyte(s,i)<<16)|(_getbyte(s,i+1)<<8)|_getbyte(s,i+2);x.push(_ALPHA.charAt(b10>>18));x.push(_ALPHA.charAt((b10>>12)&63));x.push(_ALPHA.charAt((b10>>6)&63));x.push(_ALPHA.charAt(b10&63))}switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt((b10>>12)&63)+_PADCHAR+_PADCHAR);break;case 2:b10=(_getbyte(s,i)<<16)|(_getbyte(s,i+1)<<8);x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt((b10>>12)&63)+_ALPHA.charAt((b10>>6)&63)+_PADCHAR);break}return x.join("")}return{decode:_decode,encode:_encode,VERSION:_VERSION}}(jQuery));

/*
 * Utilities
 */
_pty = {
	ari : function(a, i){
		return a[i];
	},
	idData :  function(obj){
		if(typeof obj != 'string'){
			obj = $j(obj).attr('id');
		}
		return _pty.ari(obj.split('-'), 1);
	},
	jNewer : function(v) {
		if (v === undefined) {
			v = '1.4.0';
		}
		var newer = true;
		var e = $j().jquery.split('.');
		v = v.split('.');
		$j.each(e, function(i, eV) {
			if (eV > v[i]) {
				newer = true;
				return false;
			}
			else if ( eV < v[i]) {
				newer = false;
				return false;
			}
		});
		return newer;
	},
	isset: function(str){
		var a = arguments, l = a.length, i = 0, undef;
		if (l === 0) {
			throw new Error('Empty isset');
		}
		while (i !== l) {
			if (a[i] === undef || a[i] === null) {
				return false;
			}
			i++;
		}
		return true;
	},
	getForm : function(id){
		for(var i in document.forms){
			if(document.forms[i].id == id){
				return document.forms[i];
			}
		}
	},
	formToJson : function(id){
		var data = {};
		var form = _pty.getForm(id);
		for(var i in form.elements){
			if (form.elements[i].name !== undefined && typeof form.elements[i] == 'object') {
				data[form.elements[i].name] = form.elements[i].value+'';
			}
		}
		return data;
	},
	send: function(action, data, callback, opts) {
		var completed = false;
		if(opts === undefined){
			opts = {silent : false, timeout : 10000};
		}
		//Add preset data
		data.action = 'pty_' + action;
		data.incoming_ajax = true;
		//Make Ajax Request
		$j.ajax({
			url : PTY_AJAX,
			data : data,
			type : 'POST',
			dataType : 'json',
			complete : function(rsp, status){

				json = '';

				// completed makes sure we don't run request twice (jquery jsonp bug)
				if(!completed){
					clearTimeout(pty.errTimeout);
					if(rsp !== undefined){
						var text = rsp.responseText+'';
						if (!_pty.jNewer()) {
							text = text.substr(text.indexOf('{'), (text.length-text.indexOf('{')-1));
						}
						if(!opts.silent){
							if(text.indexOf('"suc"') > -1){
								json =	$j.parseJSON(text);
								if(_pty.isset(callback)){
									callback(json);
								}
							}
							else{
								if(rsp.responseText.indexOf('"err"') > -1){
									json = $j.parseJSON(text);
								}
							}
						}
					}
					completed = true;
				}
			}
		});
	},
	trim: function(str){
		return str.replace(/^\s+|\s+$/g,"");
	},
	now: function() {
		var now = new Date();
		return now.getTime()/1000;
	},
	addSlashes: function(str){
		return (str+'').replace(/([\\"'])/g, "\\$1").replace(/\u0000/g, "\\0");
	},
	stripSlashes: function(str){
		var slashSingleGex = new RegExp(/(\\+)'/g);
		var slashDoubleGex = new RegExp(/(\\+)"/g);
		str = (str+'').replace(/\\(.?)/g, function (s, n1) {
			switch (n1) {
				case '\\':
					return '\\';
				case '0':
					return '\0';
				case '':
					return '';
				default:
					return n1;
			}
		});
		str = str.replace(slashSingleGex, "'");
		str = str.replace(slashDoubleGex, '"');
		return str;
	},
	__end : true
};
pty.do_hook('loaded');

// Get things going
pty.events();
pty.preload();
if (pty.now !== undefined && pty.now) {
	pty.open();
} else {
	pty.start();
}